<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/controllers/settings.php - flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/: Flawless.API.html">: Flawless.API</a></li>
            
                <li><a href="../classes/: Flawless.Element.html">: Flawless.Element</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Module.html">: Flawless.Flawless_Module</a></li>
            
                <li><a href="../classes/: Flawless.License.html">: Flawless.License</a></li>
            
                <li><a href="../classes/Flawless.BuddyPress.html">Flawless.BuddyPress</a></li>
            
                <li><a href="../classes/Flawless.Flawless\Shortcode.html">Flawless.Flawless\Shortcode</a></li>
            
                <li><a href="../classes/Flawless.Flawless\Widget.html">Flawless.Flawless\Widget</a></li>
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Shortcode.html">Shortcode</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Theme UI.html">Theme UI</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Core Assets.html">Core Assets</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/controllers/settings.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php
/**
 *
 * @note Ported over from WPP 2.0 - needs a serious clean-up.
 *
 * @namespace Flawless
 */
namespace Flawless {

  /**
   * Class Settings
   *
   * Migrated from WPP 2.0.
   *
   * @package Flawless
   */
  class Settings extends UD\Settings {

    /**
     * @action after_setup_theme (10)
     *
     */
    function __construct() {
      global $wpp_asset, $wp_properties;

      //** Update WPP taxonomies */
      add_filter( &#x27;wpp_taxonomies&#x27;, array( __CLASS__, &#x27;_update_taxonomies&#x27; ) );

      //** Merge attribute classifications with default data */
      add_filter( &#x27;wpp_attribute_classifications&#x27;, array( __CLASS__, &#x27;_update_attribute_classifications&#x27; ) );

      //** Set all available assets after loading premium features to have ability to use filters on assets */
      add_action( &#x27;wpp_init&#x27;, array( __CLASS__, &#x27;set_assets&#x27; ) );

      //** Get current WP-Property configuration */
      self::get();

      //echo &quot;&lt;pre&gt;&quot;; print_r( $wp_properties ); echo &quot;&lt;/pre&gt;&quot;; die();

      //** Set Default Attribute Classification */
      reset( $wp_properties[ &#x27;_attribute_classifications&#x27; ] );
      define( &#x27;WPP_Default_Classification&#x27;, key( $wp_properties[ &#x27;_attribute_classifications&#x27; ] ) );

      //** Set Default Attribute&#x27;s Group */
      reset( $wp_properties[ &#x27;_predefined_groups&#x27; ] );
      $default_group = !empty( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;main_stats_group&#x27; ] ) ? $wp_properties[ &#x27;configuration&#x27; ][ &#x27;main_stats_group&#x27; ] : key( $wp_properties[ &#x27;_predefined_groups&#x27; ] );
      define( &#x27;WPP_Default_Group&#x27;, $default_group );

      $build_mode = isset( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;build_mode&#x27; ] ) ? $wp_properties[ &#x27;configuration&#x27; ][ &#x27;build_mode&#x27; ] : false;
      $build_mode = ( $build_mode == &#x27;true&#x27; ) ? true : false;

      //** Set assets compiler */
      $wpp_asset = new UD_Asset( array(
        //** Recompile if input file was changed */
        &#x27;monitor&#x27; =&gt; $build_mode,
        //** Prefix which will be used in dynamic asset&#x27;s permalink */
        &#x27;prefix&#x27; =&gt; &#x27;wpp&#x27;,
        //** Required libraries */
        &#x27;pathes&#x27; =&gt; array(
          &#x27;lessc&#x27; =&gt; WPP_Path . &#x27;third-party/lessphp/lessc.inc.php&#x27;,
          &#x27;jsmin&#x27; =&gt; WPP_Path . &#x27;third-party/jsmin.php&#x27;,
        )
      ) );

    }

    /**
     * Saves configuration data - can be used via AJAX call.
     * $params roo keys may include: wp_options and wpp_settings
     *
     * @author potanin@UD
     */
    static function save( $params = false, $args = array() ) {
      global $wp_properties;

      $params = wp_parse_args( $params );

      $args = wp_parse_args( $args, array( &#x27;verify_nonce&#x27; =&gt; true ) );

      if ( $args[ &#x27;verify_nonce&#x27; ] &amp;&amp; !wp_verify_nonce( $params[ &#x27;_wpnonce&#x27; ], &#x27;wpp_setting_save&#x27; ) ) {
        return array( &#x27;success&#x27; =&gt; false, &#x27;message&#x27; =&gt; &#x27;Validation fail&#x27; );
      }

      /* Saves any wp_option[] named fields into options table */
      foreach ( (array) $params[ &#x27;wp_options&#x27; ] as $option_name =&gt; $option_value ) {
        update_option( $option_name, $option_value );
      }

      /* Protected Top Level Setting Keys - will be preserved if completely empty */
      $_protected = array( &#x27;configuration&#x27;, &#x27;property_types&#x27; );

      $new_settings = $params[ &#x27;wpp_settings&#x27; ];

      $new_settings = apply_filters( &#x27;wpp_settings_save&#x27;, $new_settings, $wp_properties );

      foreach ( (array) $_protected as $key ) {
        if ( empty( $new_settings[ $key ] ) ) {
          $new_settings[ $key ] = $wp_properties[ $key ];
        }
      }

      // Prevent removal of featured settings configurations if they are not present
      foreach ( (array) $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ] as $feature_type =&gt; $preserved_settings ) {
        if ( empty( $params[ &#x27;wpp_settings&#x27; ][ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ $feature_type ] ) ) {
          $new_settings[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ $feature_type ] = $preserved_settings;
        }
      }

      /* Generate weekly backup */
      if ( time() - get_option( &#x27;wpp_settings::last_backup&#x27;, 0 ) &gt; ( 60 * 60 * 24 * 7 ) &amp;&amp; get_option( &#x27;wpp_settings&#x27;, false ) ) {
        add_option( &#x27;wpp_settings::backup::&#x27; . time(), array_merge( array( &#x27;_version&#x27; =&gt; WPP_Version ), get_option( &#x27;wpp_settings&#x27;, array() ) ), &#x27;&#x27;, &#x27;no&#x27; );
        update_option( &#x27;wpp_settings::last_backup&#x27;, time() );
      }

      /** The only computed values added to the regular settings */
      $new_settings[ &#x27;_version&#x27; ] = WPP_Version;
      $new_settings[ &#x27;_updated&#x27; ] = time();

      update_option( &#x27;wpp_settings&#x27;, $new_settings );

      $wp_properties = self::get( array( &#x27;recompute&#x27; =&gt; true ) );

      return array( &#x27;success&#x27; =&gt; true, &#x27;configuration&#x27; =&gt; $wp_properties );

    }

    /**
     * Returns properties configuration
     *
     * @since 2.0
     * @author potanin@UD
     */
    static function get( $args = array() ) {

      global $wp_properties;

      $wp_properties = get_option( &#x27;wpp_settings&#x27;, array() );

      $args = wp_parse_args( $args, array(
        &#x27;strip_protected_keys&#x27; =&gt; false,
        &#x27;stripslashes&#x27; =&gt; false,
        &#x27;sort&#x27; =&gt; false,
        &#x27;recompute&#x27; =&gt; ( defined( &#x27;DOING_AJAX&#x27; ) &amp;&amp; DOING_AJAX ) ? false : $wp_properties[ &#x27;configuration&#x27; ][ &#x27;build_mode&#x27; ],
      ) );

      //** System WPP Settings */
      $system_settings = array();
      $trns = !$args[ &#x27;recompute&#x27; ] ? get_transient( &#x27;wpp::system_settings&#x27; ) : false;
      if ( !empty( $trns ) &amp;&amp; $trns != &#x27;[]&#x27; ) {
        $system_settings = json_decode( $trns, true );
      } else {
        $system_settings = self::_localize( json_decode( file_get_contents( WPP_Schemas . &#x27;/system.settings.json&#x27; ), true ) );
        set_transient( &#x27;wpp::system_settings&#x27;, json_encode( $system_settings ), ( 60 * 60 * 24 ) );
      }

      $wp_properties = WPP_F::extend( array(
        &#x27;property_stats&#x27; =&gt; array(),
        &#x27;attribute_classification&#x27; =&gt; array(),
        &#x27;property_stats_descriptions&#x27; =&gt; array(),
        &#x27;admin_attr_fields&#x27; =&gt; array(),
        &#x27;searchable_attr_fields&#x27; =&gt; array(),
        &#x27;sortable_attributes&#x27; =&gt; array(),
        &#x27;searchable_attributes&#x27; =&gt; array(),
        &#x27;predefined_values&#x27; =&gt; array(),
        &#x27;predefined_search_values&#x27; =&gt; array(),
        &#x27;property_types&#x27; =&gt; array(),
        &#x27;property_groups&#x27; =&gt; array(),
        &#x27;property_stats_groups&#x27; =&gt; array(),
        &#x27;searchable_property_types&#x27; =&gt; array(),
        &#x27;hidden_attributes&#x27; =&gt; array(),
        &#x27;property_meta&#x27; =&gt; array(), // Depreciated element. It has not been used since 2.0 version
        &#x27;property_inheritance&#x27; =&gt; array(),
        &#x27;image_sizes&#x27; =&gt; array(),
      ), $system_settings, (array) $wp_properties );

      // Filters are applied
      $wp_properties[ &#x27;configuration&#x27; ] = apply_filters( &#x27;wpp_configuration&#x27;, (array) ( !empty( $wp_properties[ &#x27;configuration&#x27; ] ) ? $wp_properties[ &#x27;configuration&#x27; ] : array() ) );
      $wp_properties[ &#x27;taxonomies&#x27; ] = apply_filters( &#x27;wpp_taxonomies&#x27;, ( !empty( $wp_properties[ &#x27;taxonomies&#x27; ] ) ? (array) $wp_properties[ &#x27;taxonomies&#x27; ] : array() ) );
      $wp_properties[ &#x27;property_stats_descriptions&#x27; ] = apply_filters( &#x27;wpp_label_descriptions&#x27;, (array) ( !empty( $wp_properties[ &#x27;property_stats_descriptions&#x27; ] ) ? $wp_properties[ &#x27;property_stats_descriptions&#x27; ] : array() ) );
      $wp_properties[ &#x27;location_matters&#x27; ] = apply_filters( &#x27;wpp_location_matters&#x27;, (array) ( !empty( $wp_properties[ &#x27;location_matters&#x27; ] ) ? $wp_properties[ &#x27;location_matters&#x27; ] : array() ) );
      $wp_properties[ &#x27;hidden_attributes&#x27; ] = apply_filters( &#x27;wpp_hidden_attributes&#x27;, (array) ( !empty( $wp_properties[ &#x27;hidden_attributes&#x27; ] ) ? $wp_properties[ &#x27;hidden_attributes&#x27; ] : array() ) );
      $wp_properties[ &#x27;image_sizes&#x27; ] = apply_filters( &#x27;wpp_image_sizes&#x27;, (array) ( !empty( $wp_properties[ &#x27;image_sizes&#x27; ] ) ? $wp_properties[ &#x27;image_sizes&#x27; ] : array() ) );
      $wp_properties[ &#x27;searchable_attributes&#x27; ] = apply_filters( &#x27;wpp_searchable_attributes&#x27;, (array) ( !empty( $wp_properties[ &#x27;searchable_attributes&#x27; ] ) ? $wp_properties[ &#x27;searchable_attributes&#x27; ] : array() ) );
      $wp_properties[ &#x27;searchable_property_types&#x27; ] = apply_filters( &#x27;wpp_searchable_property_types&#x27;, (array) ( !empty( $wp_properties[ &#x27;searchable_property_types&#x27; ] ) ? $wp_properties[ &#x27;searchable_property_types&#x27; ] : array() ) );
      $wp_properties[ &#x27;property_stats&#x27; ] = apply_filters( &#x27;wpp_property_stats&#x27;, (array) ( !empty( $wp_properties[ &#x27;property_stats&#x27; ] ) ? $wp_properties[ &#x27;property_stats&#x27; ] : array() ) );
      $wp_properties[ &#x27;property_types&#x27; ] = apply_filters( &#x27;wpp_property_types&#x27;, (array) ( !empty( $wp_properties[ &#x27;property_types&#x27; ] ) ? $wp_properties[ &#x27;property_types&#x27; ] : array() ) );
      $wp_properties[ &#x27;search_conversions&#x27; ] = apply_filters( &#x27;wpp_search_conversions&#x27;, (array) ( !empty( $wp_properties[ &#x27;search_conversions&#x27; ] ) ? $wp_properties[ &#x27;search_conversions&#x27; ] : array() ) );
      $wp_properties[ &#x27;property_inheritance&#x27; ] = apply_filters( &#x27;wpp_property_inheritance&#x27;, (array) ( !empty( $wp_properties[ &#x27;property_inheritance&#x27; ] ) ? $wp_properties[ &#x27;property_inheritance&#x27; ] : array() ) );
      $wp_properties[ &#x27;_attribute_classifications&#x27; ] = apply_filters( &#x27;wpp_attribute_classifications&#x27;, (array) ( !empty( $wp_properties[ &#x27;_attribute_classifications&#x27; ] ) ? $wp_properties[ &#x27;_attribute_classifications&#x27; ] : array() ) );

      // Extend computed settings into WPP
      $wp_properties = WPP_F::extend( self::get_computed( array( &#x27;recompute&#x27; =&gt; $args[ &#x27;recompute&#x27; ] ) ), $wp_properties );

      if ( $args[ &#x27;stripslashes&#x27; ] ) {
        $wp_properties = stripslashes_deep( $wp_properties );
      }

      if ( $args[ &#x27;sort&#x27; ] ) {
        ksort( $wp_properties );
      }

      if ( $args[ &#x27;strip_protected_keys&#x27; ] ) {
        $wp_properties = WPP_F::strip_protected_keys( $wp_properties );
      }

      if ( defined( &#x27;WPP_DEBUG&#x27; ) &amp;&amp; WPP_DEBUG ) {
        $wp_properties[ &#x27;configuration&#x27; ][ &#x27;developer_mode&#x27; ] = &#x27;true&#x27;;
      }

      //** Get rid of disabled attributes */
      if ( is_array( $wp_properties[ &#x27;disabled_attributes&#x27; ] ) ) {
        foreach ( $wp_properties[ &#x27;disabled_attributes&#x27; ] as $attribute ) {
          if ( array_key_exists( $attribute, $wp_properties[ &#x27;property_stats&#x27; ] ) ) {
            if ( isset( $wp_properties[ &#x27;property_stats&#x27; ][ $attribute ] ) ) {
              unset( $wp_properties[ &#x27;property_stats&#x27; ][ $attribute ] );
            }
            if ( isset( $wp_properties[ &#x27;attribute_classification&#x27; ][ $attribute ] ) ) {
              unset( $wp_properties[ &#x27;property_stats&#x27; ][ $attribute ] );
            }
            if ( isset( $wp_properties[ &#x27;property_stats_groups&#x27; ][ $attribute ] ) ) {
              unset( $wp_properties[ &#x27;property_stats_groups&#x27; ][ $attribute ] );
            }
            if ( isset( $wp_properties[ &#x27;property_stats_descriptions&#x27; ][ $attribute ] ) ) {
              unset( $wp_properties[ &#x27;property_stats_descriptions&#x27; ][ $attribute ] );
            }
            if ( isset( $wp_properties[ &#x27;searchable_attr_fields&#x27; ][ $attribute ] ) ) {
              unset( $wp_properties[ &#x27;searchable_attr_fields&#x27; ][ $attribute ] );
            }
            if ( isset( $wp_properties[ &#x27;admin_attr_fields&#x27; ][ $attribute ] ) ) {
              unset( $wp_properties[ &#x27;admin_attr_fields&#x27; ][ $attribute ] );
            }
            if ( isset( $wp_properties[ &#x27;predefined_values&#x27; ][ $attribute ] ) ) {
              unset( $wp_properties[ &#x27;predefined_values&#x27; ][ $attribute ] );
            }
            if ( isset( $wp_properties[ &#x27;predefined_search_values&#x27; ][ $attribute ] ) ) {
              unset( $wp_properties[ &#x27;predefined_search_values&#x27; ][ $attribute ] );
            }
          }
        }
      }

      //** Set the list of frontend attributes */
      $wp_properties[ &#x27;frontend_property_stats&#x27; ] = $wp_properties[ &#x27;property_stats&#x27; ];
      //* System ( admin only ) attributes should not be showed. So we remove them from settings */
      foreach ( $wp_properties[ &#x27;frontend_property_stats&#x27; ] as $i =&gt; $stat ) {
        if ( isset( $wp_properties[ &#x27;attribute_classification&#x27; ][ $i ] ) ) {
          $classification = $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $wp_properties[ &#x27;attribute_classification&#x27; ][ $i ] ];
          if ( isset( $classification[ &#x27;settings&#x27; ][ &#x27;admin_only&#x27; ] ) &amp;&amp; $classification[ &#x27;settings&#x27; ][ &#x27;admin_only&#x27; ] ) {
            unset( $wp_properties[ &#x27;frontend_property_stats&#x27; ][ $i ] );
          }
        }
      }

      return $wp_properties;

    }

    /**
     * Generates Computed Settings, saves to transient, and returns.
     * By default recomputing is disabled on AJAX requests.
     *
     * @author potanin@UD
     */
    static function get_computed( $args = array() ) {

      global $wp_properties;

      $args = wp_parse_args( $args, array(
        &#x27;recompute&#x27; =&gt; ( defined( &#x27;DOING_AJAX&#x27; ) &amp;&amp; DOING_AJAX ) ? false : $wp_properties[ &#x27;configuration&#x27; ][ &#x27;build_mode&#x27; ],
      ) );

      $trns = !$args[ &#x27;recompute&#x27; ] ? get_transient( &#x27;wpp::computed&#x27; ) : false;
      if ( !empty( $trns ) &amp;&amp; $trns != &#x27;[]&#x27; ) {
        return json_decode( $trns, true );
      }

      /* Setup structure for system generated / API provided data */
      $_computed = array(
        &#x27;_computed&#x27; =&gt; time(),
        &#x27;_version&#x27; =&gt; WPP_Version,
        &#x27;_data_structure&#x27; =&gt; self::get_data_structure(),
        &#x27;_primary_keys&#x27; =&gt; array(
          &#x27;post_title&#x27; =&gt; sprintf( __( &#x27;%1$s Title&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &#x27;singular&#x27; ) ) ),
          &#x27;post_type&#x27; =&gt; __( &#x27;Post Type&#x27; ),
          &quot;post_content&quot; =&gt; sprintf( __( &#x27;%1$s Content&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &#x27;singular&#x27; ) ) ),
          &#x27;post_excerpt&#x27; =&gt; sprintf( __( &#x27;%1$s Excerpt&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &#x27;singular&#x27; ) ) ),
          &#x27;post_status&#x27; =&gt; sprintf( __( &#x27;%1$s Status&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &#x27;singular&#x27; ) ) ),
          &#x27;menu_order&#x27; =&gt; sprintf( __( &#x27;%1$s Order&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &#x27;singular&#x27; ) ) ),
          &#x27;post_date&#x27; =&gt; sprintf( __( &#x27;%1$s Date&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &quot;singular&quot; ) ) ),
          &#x27;post_author&#x27; =&gt; sprintf( __( &#x27;%1$s Author&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &quot;singular&quot; ) ) ),
          &#x27;post_date_gmt&#x27; =&gt; &#x27;&#x27;,
          &#x27;post_parent&#x27; =&gt; &#x27;&#x27;,
          &#x27;ping_status&#x27; =&gt; &#x27;&#x27;,
          &#x27;comment_status&#x27; =&gt; &#x27;&#x27;,
          &#x27;post_password&#x27; =&gt; &#x27;&#x27;
        ),
        // Core Features may be disabled via some configurations
        &#x27;_core_features&#x27; =&gt; array( &#x27;locations&#x27; =&gt; true, &#x27;featured&#x27; =&gt; true ),
        // Consolidate all localization settings
        &#x27;_locale&#x27; =&gt; array(
          &#x27;thousands_sep&#x27; =&gt; $wp_properties[ &#x27;configuration&#x27; ][ &#x27;thousands_sep&#x27; ],
          &#x27;google_maps_localization&#x27; =&gt; $wp_properties[ &#x27;configuration&#x27; ][ &#x27;google_maps_localization&#x27; ],
          &#x27;currency_symbol&#x27; =&gt; $wp_properties[ &#x27;configuration&#x27; ][ &#x27;currency_symbol&#x27; ] ),
        &#x27;_queryable_keys&#x27; =&gt; array(), // @todo
        &#x27;_searchable_geo_parts&#x27; =&gt; self::get_searchable_geo_parts(),
      );

      $_computed = (array) apply_filters( &#x27;wpp::computed&#x27;, $_computed );

      set_transient( &#x27;wpp::computed&#x27;, json_encode( $_computed ), ( 60 * 60 * 24 ) );

      return $_computed;

    }

    /**
     * Returns default wpp settings based on system ( schema/system.settings.json ) settings and on user choice ( default schema/default.settings.json )
     *
     * @param array settings. Schema
     *
     * @author peshkov@UD
     */
    static function get_default_wpp_settings( $settings = false ) {

      //** STEP 1. Create the data based on system settings */

      $system = self::_localize( json_decode( file_get_contents( WPP_Schemas . &#x27;/system.settings.json&#x27; ), true ) );

      $wpp_settings = array(
        &#x27;configuration&#x27; =&gt; $system[ &#x27;configuration&#x27; ],
        &#x27;property_stats&#x27; =&gt; array(),
        &#x27;attribute_classification&#x27; =&gt; array(),
        &#x27;property_stats_descriptions&#x27; =&gt; array(),

        &#x27;admin_attr_fields&#x27; =&gt; array(),
        &#x27;searchable_attr_fields&#x27; =&gt; array(),
        &#x27;sortable_attributes&#x27; =&gt; array(),
        &#x27;searchable_attributes&#x27; =&gt; array(),
        &#x27;column_attributes&#x27; =&gt; array(),
        &#x27;predefined_values&#x27; =&gt; array(),
        &#x27;predefined_search_values&#x27; =&gt; array(),

        &#x27;property_types&#x27; =&gt; array(),
        &#x27;searchable_property_types&#x27; =&gt; array(),
        &#x27;location_matters&#x27; =&gt; array(),

        &#x27;property_groups&#x27; =&gt; array(),
        &#x27;property_stats_groups&#x27; =&gt; array(),
      );

      //** Set default groups */
      foreach ( (array) $system[ &#x27;_predefined_groups&#x27; ] as $k =&gt; $v ) {
        $wpp_settings[ &#x27;property_groups&#x27; ][ $v[ &#x27;slug&#x27; ] ] = array(
          &#x27;name&#x27; =&gt; $v[ &#x27;label&#x27; ]
        );
      }

      //** Begin to set default property attributes here */
      $predefined_attributes = (array) $system[ &#x27;_predefined_attributes&#x27; ];

      //** Add WP taxonomy &#x27;category&#x27; to the predefined list */
      $taxonomies = array_merge( (array) $system[ &#x27;taxonomies&#x27; ], array( &#x27;category&#x27; =&gt; WPP_F::object_to_array( get_taxonomy( &#x27;category&#x27; ) ) ) );

      //** Add other taxonomies to the predefined list */
      foreach ( $taxonomies as $taxonomy =&gt; $taxonomy_data ) {
        $predefined_attributes[ $taxonomy ] = array(
          &#x27;label&#x27; =&gt; $taxonomy_data[ &#x27;label&#x27; ],
          &#x27;slug&#x27; =&gt; $taxonomy,
          &#x27;classification&#x27; =&gt; &#x27;taxonomy&#x27;,
          &#x27;description&#x27; =&gt; __( &#x27;The current attribute is just a link to the existing taxonomy.&#x27;, &#x27;wpp&#x27; ),
          &#x27;meta&#x27; =&gt; true,
        );
      }

      foreach ( $predefined_attributes as $k =&gt; $v ) {
        if ( isset( $v[ &#x27;meta&#x27; ] ) &amp;&amp; $v[ &#x27;meta&#x27; ] ) {
          $wpp_settings[ &#x27;property_stats&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $v[ &#x27;label&#x27; ];
          $wpp_settings[ &#x27;attribute_classification&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $v[ &#x27;classification&#x27; ];
          $wpp_settings[ &#x27;property_stats_descriptions&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $v[ &#x27;description&#x27; ];

          if ( !empty( $wpp_settings[ &#x27;property_groups&#x27; ] ) ) {
            $wpp_settings[ &#x27;property_stats_groups&#x27; ][ $v[ &#x27;slug&#x27; ] ] = array_shift( array_keys( $wpp_settings[ &#x27;property_groups&#x27; ] ) );
          }

          $clsf = !empty( $system[ &#x27;_attribute_classifications&#x27; ][ $v[ &#x27;classification&#x27; ] ] ) ? $system[ &#x27;_attribute_classifications&#x27; ][ $v[ &#x27;classification&#x27; ] ] : $system[ &#x27;_attribute_classifications&#x27; ][ &#x27;string&#x27; ];

          $wpp_settings[ &#x27;attribute_classification&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $clsf[ &#x27;slug&#x27; ];

          if ( isset( $clsf[ &#x27;settings&#x27; ][ &#x27;editable&#x27; ] ) &amp;&amp; $clsf[ &#x27;settings&#x27; ][ &#x27;editable&#x27; ] &amp;&amp; !empty( $clsf[ &#x27;admin&#x27; ] ) ) {
            $wpp_settings[ &#x27;admin_attr_fields&#x27; ][ $v[ &#x27;slug&#x27; ] ] = array_shift( array_keys( $clsf[ &#x27;admin&#x27; ] ) );
          }

          if ( isset( $clsf[ &#x27;settings&#x27; ][ &#x27;searchable&#x27; ] ) &amp;&amp; $clsf[ &#x27;settings&#x27; ][ &#x27;searchable&#x27; ] &amp;&amp; !empty( $clsf[ &#x27;search&#x27; ] ) ) {
            $wpp_settings[ &#x27;searchable_attr_fields&#x27; ][ $v[ &#x27;slug&#x27; ] ] = array_shift( array_keys( $clsf[ &#x27;search&#x27; ] ) );
          }
        }
      }

      //** STEP 2. Merge with &#x27;custom default&#x27; settings which can be got from specific json schema */

      //** Set Configuration */
      if ( isset( $settings[ &#x27;configuration&#x27; ] ) ) {
        $wpp_settings[ &#x27;configuration&#x27; ] = WPP_F::extend( $wpp_settings[ &#x27;configuration&#x27; ], (array) $settings[ &#x27;configuration&#x27; ] );
      }

      //** Set Property types */
      if ( isset( $settings[ &#x27;types&#x27; ] ) ) {

        $default_type = array(
          &#x27;slug&#x27; =&gt; &#x27;&#x27;,
          &#x27;label&#x27; =&gt; &#x27;&#x27;,
          &#x27;description&#x27; =&gt; &#x27;&#x27;,
          &#x27;searchable&#x27; =&gt; false,
          &#x27;location_matters&#x27; =&gt; false,
        );

        foreach ( (array) $settings[ &#x27;types&#x27; ] as $k =&gt; $v ) {
          $v = WPP_F::extend( $default_type, $v );

          $wpp_settings[ &#x27;property_types&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $v[ &#x27;label&#x27; ];

          if ( $v[ &#x27;searchable&#x27; ] ) {
            $wpp_settings[ &#x27;searchable_property_types&#x27; ][ ] = $v[ &#x27;slug&#x27; ];
          }

          if ( $v[ &#x27;location_matters&#x27; ] ) {
            $wpp_settings[ &#x27;location_matters&#x27; ][ ] = $v[ &#x27;slug&#x27; ];
          }
        }
      }

      //** Set Groups */
      if ( isset( $settings[ &#x27;groups&#x27; ] ) ) {
        $default_group = array(
          &#x27;slug&#x27; =&gt; &#x27;&#x27;,
          &#x27;label&#x27; =&gt; &#x27;&#x27;,
        );

        foreach ( $settings[ &#x27;groups&#x27; ] as $k =&gt; $v ) {
          $v = WPP_F::extend( $default_group, ( isset( $wpp_settings[ &#x27;_predefined_groups&#x27; ][ $v[ &#x27;slug&#x27; ] ] ) ? $wpp_settings[ &#x27;_predefined_groups&#x27; ][ $v[ &#x27;slug&#x27; ] ] : array() ), $v );
          $wpp_settings[ &#x27;property_groups&#x27; ][ $v[ &#x27;slug&#x27; ] ] = array(
            &#x27;name&#x27; =&gt; $v[ &#x27;label&#x27; ],
          );
        }
      }

      //** Set attributes */
      if ( isset( $settings[ &#x27;attributes&#x27; ] ) ) {

        $default_attribute = array(
          &#x27;slug&#x27; =&gt; &#x27;&#x27;,
          &#x27;label&#x27; =&gt; &#x27;&#x27;,
          &#x27;description&#x27; =&gt; &#x27;&#x27;,
          &#x27;classification&#x27; =&gt; &#x27;string&#x27;,
          &#x27;searchable&#x27; =&gt; false,
          &#x27;sortable&#x27; =&gt; false,
          &#x27;in_overview&#x27; =&gt; false,
          &#x27;search_input_type&#x27; =&gt; &#x27;input&#x27;,
          &#x27;admin_input_type&#x27; =&gt; &#x27;input&#x27;,
          &#x27;group&#x27; =&gt; !empty( $wpp_settings[ &#x27;property_groups&#x27; ] ) ? array_shift( array_keys( (array) $wpp_settings[ &#x27;property_groups&#x27; ] ) ) : false,
        );

        foreach ( (array) $settings[ &#x27;attributes&#x27; ] as $k =&gt; $v ) {
          $v = WPP_F::extend( $default_attribute, ( isset( $predefined_attributes[ $v[ &#x27;slug&#x27; ] ] ) ? $predefined_attributes[ $v[ &#x27;slug&#x27; ] ] : array() ), $v );

          if ( !empty( $v[ &#x27;slug&#x27; ] ) &amp;&amp; !empty( $v[ &#x27;label&#x27; ] ) ) {

            $wpp_settings[ &#x27;property_stats&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $v[ &#x27;label&#x27; ];
            $wpp_settings[ &#x27;attribute_classification&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $v[ &#x27;classification&#x27; ];
            $wpp_settings[ &#x27;property_stats_descriptions&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $v[ &#x27;description&#x27; ];

            if ( !empty( $v[ &#x27;group&#x27; ] ) ) {
              $v[ &#x27;group&#x27; ] = key_exists( $v[ &#x27;group&#x27; ], $wpp_settings[ &#x27;property_groups&#x27; ] ) ? $v[ &#x27;group&#x27; ] : array_shift( array_keys( $wpp_settings[ &#x27;property_groups&#x27; ] ) );
              $wpp_settings[ &#x27;property_stats_groups&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $v[ &#x27;group&#x27; ];
            }

            if ( $v[ &#x27;searchable&#x27; ] &amp;&amp; !in_array( $v[ &#x27;slug&#x27; ], $wpp_settings[ &#x27;searchable_attributes&#x27; ] ) ) {
              $wpp_settings[ &#x27;searchable_attributes&#x27; ][ ] = $v[ &#x27;slug&#x27; ];
            }

            if ( $v[ &#x27;sortable&#x27; ] &amp;&amp; !in_array( $v[ &#x27;slug&#x27; ], $wpp_settings[ &#x27;sortable_attributes&#x27; ] ) ) {
              $wpp_settings[ &#x27;sortable_attributes&#x27; ][ ] = $v[ &#x27;slug&#x27; ];
            }

            if ( $v[ &#x27;in_overview&#x27; ] &amp;&amp; !in_array( $v[ &#x27;slug&#x27; ], $wpp_settings[ &#x27;column_attributes&#x27; ] ) ) {
              $wpp_settings[ &#x27;column_attributes&#x27; ][ ] = $v[ &#x27;slug&#x27; ];
            }

            $clsf = !empty( $system[ &#x27;_attribute_classifications&#x27; ][ $v[ &#x27;classification&#x27; ] ] ) ? $system[ &#x27;_attribute_classifications&#x27; ][ $v[ &#x27;classification&#x27; ] ] : $system[ &#x27;_attribute_classifications&#x27; ][ &#x27;string&#x27; ];

            $wpp_settings[ &#x27;attribute_classification&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $clsf[ &#x27;slug&#x27; ];

            if ( isset( $clsf[ &#x27;settings&#x27; ][ &#x27;editable&#x27; ] ) &amp;&amp; $clsf[ &#x27;settings&#x27; ][ &#x27;editable&#x27; ] &amp;&amp; !empty( $clsf[ &#x27;admin&#x27; ] ) ) {
              $v[ &#x27;admin_input_type&#x27; ] = !empty( $v[ &#x27;admin_input_type&#x27; ] ) &amp;&amp; key_exists( $v[ &#x27;admin_input_type&#x27; ], $clsf[ &#x27;admin&#x27; ] ) ? $v[ &#x27;admin_input_type&#x27; ] : array_shift( array_keys( $clsf[ &#x27;admin&#x27; ] ) );
              $wpp_settings[ &#x27;admin_attr_fields&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $v[ &#x27;admin_input_type&#x27; ];
            }

            if ( isset( $clsf[ &#x27;settings&#x27; ][ &#x27;searchable&#x27; ] ) &amp;&amp; $clsf[ &#x27;settings&#x27; ][ &#x27;searchable&#x27; ] &amp;&amp; !empty( $clsf[ &#x27;search&#x27; ] ) ) {
              $v[ &#x27;search_input_type&#x27; ] = !empty( $v[ &#x27;search_input_type&#x27; ] ) &amp;&amp; key_exists( $v[ &#x27;search_input_type&#x27; ], $clsf[ &#x27;search&#x27; ] ) ? $v[ &#x27;search_input_type&#x27; ] : array_shift( array_keys( $clsf[ &#x27;search&#x27; ] ) );
              $wpp_settings[ &#x27;searchable_attr_fields&#x27; ][ $v[ &#x27;slug&#x27; ] ] = $v[ &#x27;search_input_type&#x27; ];
            }

          }
        }
      }

      return $wpp_settings;

    }

    /**
     * Returns the list of attributes belonging to geo classification which are searchable
     *
     * @return array
     * @author peshkov@UD
     */
    static function get_searchable_geo_parts() {
      $result = array();
      $data_sctructure = self::get_data_structure();
      foreach ( (array) $data_sctructure[ &#x27;attributes&#x27; ] as $k =&gt; $v ) {
        if ( $v[ &#x27;classification&#x27; ] == &#x27;geo&#x27; &amp;&amp; isset( $v[ &#x27;searchable&#x27; ] ) &amp;&amp; $v[ &#x27;searchable&#x27; ] ) {
          $result[ $k ] = $v[ &#x27;label&#x27; ];
        }
      }
      return $result;
    }

    /**
     * Return array of WPP attributes, groups and types structure.
     *
     * @todo Taxonomy counts and some sort of uniqueness / quality score. - potanin@UD 8/14/12
     * @author potanin@UD
     * @author peshkov@UD
     */
    static function get_data_structure( $args = false ) {
      global $wpdb, $wp_properties;

      //** STEP 1. Init all neccessary variables before continue. */

      $args = wp_parse_args( $args, array(
        &#x27;analyze_usage&#x27; =&gt; false,
      ) );

      //** Default classification */
      $def_cl_slug = &#x27;string&#x27;;
      $def_cl = !empty( $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $def_cl_slug ] ) ? $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $def_cl_slug ] : false;
      //** Classification Taxonomy */
      $def_cl_tax_slug = &#x27;taxonomy&#x27;;
      $def_cl_tax = !empty( $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $def_cl_tax_slug ] ) ? $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $def_cl_tax_slug ] : false;
      //** Default group */
      $def_group_slug = &#x27;wpp_main&#x27;;
      $def_group = !empty( $wp_properties[ &#x27;_predefined_groups&#x27; ][ $def_group_slug ] ) ? $wp_properties[ &#x27;_predefined_groups&#x27; ][ $def_group_slug ] : false;

      $default_attribute = array(
        &#x27;label&#x27; =&gt; &#x27;&#x27;,
        &#x27;slug&#x27; =&gt; &#x27;&#x27;,
        &#x27;description&#x27; =&gt; &#x27;&#x27;,
        // Classification
        &#x27;classification&#x27; =&gt; !empty( $def_cl ) ? $def_cl_slug : false,
        &#x27;classification_label&#x27; =&gt; !empty( $def_cl ) ? $def_cl[ &#x27;label&#x27; ] : false,
        &#x27;classification_settings&#x27; =&gt; !empty( $def_cl ) ? $def_cl[ &#x27;settings&#x27; ] : false,
        // Specific data
        &#x27;type&#x27; =&gt; &#x27;meta&#x27;, // Available values: &#x27;post&#x27;, &#x27;meta&#x27;, &#x27;taxonomy&#x27;
        &#x27;values&#x27; =&gt; false,
        &#x27;group&#x27; =&gt; !empty( $def_group ) ? $def_group_slug : false,
        &#x27;path&#x27; =&gt; false, // {group}.{attribute}
        &#x27;reserved&#x27; =&gt; false, // It&#x27;s predefined by WPP or not
        &#x27;system&#x27; =&gt; false, // true if attribute is system data ( e.g. wp_posts data, like post_title, etc )
        &#x27;admin_inputs&#x27; =&gt; array(),
        &#x27;search_inputs&#x27; =&gt; array(),
        // Settings
        &#x27;searchable&#x27; =&gt; false,
        &#x27;sortable&#x27; =&gt; false,
        &#x27;in_overview&#x27; =&gt; false,
        &#x27;disabled&#x27; =&gt; false,
        &#x27;search_input_type&#x27; =&gt; false,
        &#x27;admin_input_type&#x27; =&gt; false,
        &#x27;search_predefined&#x27; =&gt; false,
        &#x27;admin_predefined&#x27; =&gt; false,
        &#x27;path&#x27; =&gt; false,
      );

      $default_group = array(
        &#x27;label&#x27; =&gt; &#x27;&#x27;,
        &#x27;slug&#x27; =&gt; &#x27;&#x27;,
        &#x27;reserved&#x27; =&gt; false,
      );

      $return = array(
        &#x27;attributes&#x27; =&gt; array(),
        &#x27;groups&#x27; =&gt; array(),
        &#x27;types&#x27; =&gt; array(),
      );

      //** STEP 2. Prepare the list of &#x27;post column&#x27; attributes. These attributes are system and cannot be created or edited by user */
      $system_attributes = array();
      //** Add to system attributes all specific WP data ( wp_posts columns ) */
      $columns = $wpdb-&gt;get_results( &quot;SELECT DISTINCT( column_name ) FROM information_schema.columns WHERE table_name = &#x27;{$wpdb-&gt;posts}&#x27;&quot;, ARRAY_N );
      foreach ( $columns as $column ) {
        $system_attributes[ ] = $column[ 0 ];
      }

      //** STEP 3. Prepare the list of predefined attributes ( Taxonomies also are related to this list ). These attributes cannot be created by user. */

      $predefined_attributes = !empty( $wp_properties[ &#x27;_predefined_attributes&#x27; ] ) ? $wp_properties[ &#x27;_predefined_attributes&#x27; ] : array();

      foreach ( $predefined_attributes as $k =&gt; $v ) {
        $predefined_attributes[ $k ][ &#x27;type&#x27; ] = in_array( $k, $system_attributes ) ? &#x27;post&#x27; : ( isset( $predefined_attributes[ $k ][ &#x27;meta&#x27; ] ) &amp;&amp; !$predefined_attributes[ $k ][ &#x27;meta&#x27; ] ? &#x27;post&#x27; : &#x27;meta&#x27; );
        if ( isset( $v[ &#x27;classification&#x27; ] ) &amp;&amp; !empty( $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $v[ &#x27;classification&#x27; ] ] ) ) {
          $predefined_attributes[ $k ][ &#x27;classification_label&#x27; ] = $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $v[ &#x27;classification&#x27; ] ][ &#x27;label&#x27; ];
          $predefined_attributes[ $k ][ &#x27;classification_settings&#x27; ] = $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $v[ &#x27;classification&#x27; ] ][ &#x27;settings&#x27; ];
        }
        $predefined_attributes[ $k ] = array_merge( $default_attribute, $predefined_attributes[ $k ] );
      }

      $taxonomies = !empty( $wp_properties[ &#x27;taxonomies&#x27; ] ) ? (array) $wp_properties[ &#x27;taxonomies&#x27; ] : array();
      //** Add WP taxonomy &#x27;category&#x27; to the predefined list */
      $taxonomies[ &#x27;category&#x27; ] = WPP_F::object_to_array( get_taxonomy( &#x27;category&#x27; ) );

      //** Add other taxonomies to the predefined list */
      foreach ( $taxonomies as $taxonomy =&gt; $taxonomy_data ) {
        $predefined_attributes[ $taxonomy ] = array_merge( $default_attribute, array_filter( array(
          &#x27;label&#x27; =&gt; $taxonomy_data[ &#x27;label&#x27; ],
          &#x27;slug&#x27; =&gt; $taxonomy,
          &#x27;type&#x27; =&gt; &#x27;taxonomy&#x27;,
          &#x27;decription&#x27; =&gt; __( &#x27;The current attribute is just a link to the existing taxonomy.&#x27;, &#x27;wpp&#x27; ),
          &#x27;classification&#x27; =&gt; !empty( $def_cl_tax ) ? $def_cl_tax_slug : false,
          &#x27;classification_label&#x27; =&gt; !empty( $def_cl_tax ) ? $def_cl_tax[ &#x27;label&#x27; ] : false,
          &#x27;classification_settings&#x27; =&gt; !empty( $def_cl_tax ) ? $def_cl_tax[ &#x27;settings&#x27; ] : false,
        ) ) );
      }

      //** STEP 4. Get the main list of all property attributes and merge them with system and predefined attributes */

      $attributes = self::get_total_attribute_array();

      foreach ( $attributes as $meta_key =&gt; $label ) {
        $_data = self::get_attribute_data( $meta_key );

        $default = array_key_exists( $meta_key, $predefined_attributes ) ? $predefined_attributes[ $meta_key ] : $default_attribute;

        $return[ &#x27;attributes&#x27; ][ $meta_key ] = WPP_F::extend( $default, array_filter( array(
          &#x27;label&#x27; =&gt; $_data[ &#x27;label&#x27; ],
          &#x27;slug&#x27; =&gt; $_data[ &#x27;slug&#x27; ],
          &#x27;description&#x27; =&gt; isset( $_data[ &#x27;description&#x27; ] ) ? $_data[ &#x27;description&#x27; ] : false,
          &#x27;values&#x27; =&gt; !empty( $_data[ &#x27;_values&#x27; ] ) ? $_data[ &#x27;_values&#x27; ] : false,
          &#x27;group&#x27; =&gt; isset( $_data[ &#x27;group_key&#x27; ] ) ? $_data[ &#x27;group_key&#x27; ] : false,
          &#x27;reserved&#x27; =&gt; array_key_exists( $meta_key, $predefined_attributes ) ? true : false,
          &#x27;searchable&#x27; =&gt; isset( $_data[ &#x27;searchable&#x27; ] ) ? $_data[ &#x27;searchable&#x27; ] : false,
          &#x27;sortable&#x27; =&gt; isset( $_data[ &#x27;sortable&#x27; ] ) ? $_data[ &#x27;sortable&#x27; ] : false,
          &#x27;in_overview&#x27; =&gt; isset( $_data[ &#x27;in_overview&#x27; ] ) ? $_data[ &#x27;in_overview&#x27; ] : false,
          &#x27;disabled&#x27; =&gt; isset( $_data[ &#x27;disabled&#x27; ] ) ? $_data[ &#x27;disabled&#x27; ] : false,
          &#x27;search_input_type&#x27; =&gt; isset( $_data[ &#x27;input_type&#x27; ] ) ? $_data[ &#x27;input_type&#x27; ] : false,
          &#x27;admin_input_type&#x27; =&gt; isset( $_data[ &#x27;data_input_type&#x27; ] ) ? $_data[ &#x27;data_input_type&#x27; ] : false,
          &#x27;search_predefined&#x27; =&gt; isset( $_data[ &#x27;predefined_search_values&#x27; ] ) ? $_data[ &#x27;predefined_search_values&#x27; ] : false,
          &#x27;admin_predefined&#x27; =&gt; isset( $_data[ &#x27;predefined_values&#x27; ] ) ? $_data[ &#x27;predefined_values&#x27; ] : false,
          &#x27;path&#x27; =&gt; ( $_data[ &#x27;group_key&#x27; ] ? $_data[ &#x27;group_key&#x27; ] . &#x27;.&#x27; . $_data[ &#x27;slug&#x27; ] : false ),
          &#x27;classification&#x27; =&gt; array_key_exists( $meta_key, $predefined_attributes ) ? $predefined_attributes[ $meta_key ][ &#x27;classification&#x27; ] : false,
          &#x27;classification_label&#x27; =&gt; array_key_exists( $meta_key, $predefined_attributes ) ? $predefined_attributes[ $meta_key ][ &#x27;classification_label&#x27; ] : false,
          &#x27;classification_settings&#x27; =&gt; array_key_exists( $meta_key, $predefined_attributes ) ? $predefined_attributes[ $meta_key ][ &#x27;classification_settings&#x27; ] : false,
        ) ) );

        //** Set specific data based on system and predefined attributes */
        $return[ &#x27;attributes&#x27; ][ $meta_key ][ &#x27;type&#x27; ] = in_array( $meta_key, $system_attributes ) ? &#x27;post&#x27; : &#x27;meta&#x27;;
        if ( array_key_exists( $meta_key, $predefined_attributes ) ) {
          $return[ &#x27;attributes&#x27; ][ $meta_key ][ &#x27;type&#x27; ] = $predefined_attributes[ $meta_key ][ &#x27;type&#x27; ];
        } else {
          /* Check if the slug exists in classifications, if so, override classification&#x27;s settings */
          $classification = !empty( $wp_properties[ &#x27;attribute_classification&#x27; ][ $meta_key ] ) ? $wp_properties[ &#x27;attribute_classification&#x27; ][ $meta_key ] : false;
          if ( $classification &amp;&amp; isset( $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $classification ] ) ) {
            $return[ &#x27;attributes&#x27; ][ $meta_key ][ &#x27;classification&#x27; ] = $classification;
            $return[ &#x27;attributes&#x27; ][ $meta_key ][ &#x27;classification_label&#x27; ] = $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $classification ][ &#x27;label&#x27; ];
            $return[ &#x27;attributes&#x27; ][ $meta_key ][ &#x27;classification_settings&#x27; ] = $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $classification ][ &#x27;settings&#x27; ];
          }
        }
      }

      foreach ( $predefined_attributes as $k =&gt; $v ) {
        if ( !array_key_exists( $k, $return[ &#x27;attributes&#x27; ] ) ) {
          $return[ &#x27;attributes&#x27; ][ $k ] = $predefined_attributes[ $k ];
        }
      }

      //** Set specific data based on classification and type, etc */
      foreach ( $return[ &#x27;attributes&#x27; ] as $k =&gt; $v ) {
        if ( $v[ &#x27;type&#x27; ] === &#x27;post&#x27; ) {
          $return[ &#x27;attributes&#x27; ][ $k ][ &#x27;system&#x27; ] = true;
          $return[ &#x27;attributes&#x27; ][ $k ][ &#x27;reserved&#x27; ] = true;
        }
        if ( array_key_exists( $k, $predefined_attributes ) ) {
          $return[ &#x27;attributes&#x27; ][ $k ][ &#x27;reserved&#x27; ] = true;
        }
        if ( !empty( $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $v[ &#x27;classification&#x27; ] ][ &#x27;admin&#x27; ] ) ) {
          foreach ( (array) $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $v[ &#x27;classification&#x27; ] ][ &#x27;admin&#x27; ] as $slug =&gt; $label ) {
            $return[ &#x27;attributes&#x27; ][ $k ][ &#x27;admin_inputs&#x27; ][ ] = array( &#x27;slug&#x27; =&gt; $slug, &#x27;label&#x27; =&gt; $label );
          }
        }
        if ( !empty( $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $v[ &#x27;classification&#x27; ] ][ &#x27;search&#x27; ] ) ) {
          foreach ( (array) $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $v[ &#x27;classification&#x27; ] ][ &#x27;search&#x27; ] as $slug =&gt; $label ) {
            $return[ &#x27;attributes&#x27; ][ $k ][ &#x27;search_inputs&#x27; ][ ] = array( &#x27;slug&#x27; =&gt; $slug, &#x27;label&#x27; =&gt; $label );
          }
        }
      }

      //** STEP 5. ANALYZE USAGE. If Analyze usage is needed we update attributes data based on type */

      if ( $args[ &#x27;analyze_usage&#x27; ] ) {
        foreach ( $return[ &#x27;attributes&#x27; ] as $k =&gt; $v ) {
          switch ( $v[ &#x27;type&#x27; ] ) {
            case &#x27;post&#x27;:
              //** Not sure what could be here. peshkov@UD */
              break;
            case &#x27;meta&#x27;:
              $return[ &#x27;attributes&#x27; ][ $k ][ &#x27;total_usage&#x27; ] = ( int ) $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;
              SELECT COUNT( post_id )
              FROM {$wpdb-&gt;postmeta}
              WHERE meta_key = %s
                AND meta_value != &#x27;&#x27;;
            &quot;, $meta_key ) );
              $return[ &#x27;attributes&#x27; ][ $k ][ &#x27;uniqueness&#x27; ] = ( int ) $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;
              SELECT COUNT(DISTINCT(meta_value ))
              FROM {$wpdb-&gt;postmeta}
              WHERE meta_key = %s
                AND meta_value !=&#x27;&#x27;;
            &quot;, $meta_key ) );
              break;
            case &#x27;taxonomy&#x27;:
              $return[ &#x27;attributes&#x27; ][ $k ][ &#x27;values&#x27; ] = $wpdb-&gt;get_col( $wpdb-&gt;prepare( &quot;
              SELECT name
              FROM {$wpdb-&gt;terms} t
                LEFT JOIN {$wpdb-&gt;term_taxonomy} tr ON t.term_id = tr.term_id
              WHERE tr.taxonomy = %s;
            &quot;, $k ) );
              break;
          }
        }
      }

      //** STEP 6. Set property types and groups and return data */

      foreach ( (array) $wp_properties[ &#x27;property_types&#x27; ] as $slug =&gt; $label ) {
        $return[ &#x27;types&#x27; ][ $slug ] = array(
          &#x27;label&#x27; =&gt; $label,
          &#x27;slug&#x27; =&gt; $slug,
          &#x27;meta&#x27; =&gt; $wp_properties[ &#x27;property_type_meta&#x27; ][ $slug ],
          &#x27;settings&#x27; =&gt; array(
            &#x27;geolocatable&#x27; =&gt; in_array( $slug, (array) $wp_properties[ &#x27;location_matters&#x27; ] ) ? true : false,
            &#x27;searchable&#x27; =&gt; in_array( $slug, (array) $wp_properties[ &#x27;searchable_property_types&#x27; ] ) ? true : false,
            &#x27;hierarchical&#x27; =&gt; in_array( $slug, (array) $wp_properties[ &#x27;hierarchical_property_types&#x27; ] ) ? true : false,
          ),
          &#x27;hidden_attributes&#x27; =&gt; (array) $wp_properties[ &#x27;hidden_attributes&#x27; ][ $slug ],
          &#x27;property_inheritance&#x27; =&gt; (array) $wp_properties[ &#x27;property_inheritance&#x27; ][ $slug ],
        );
      }

      $predefined_groups = !empty( $wp_properties[ &#x27;_predefined_groups&#x27; ] ) ? $wp_properties[ &#x27;_predefined_groups&#x27; ] : array();
      if ( !empty( $wp_properties[ &#x27;property_groups&#x27; ] ) ) {
        foreach ( (array) $wp_properties[ &#x27;property_groups&#x27; ] as $group_slug =&gt; $data ) {
          $default = array_key_exists( $group_slug, $predefined_groups ) ? array_merge( $default_group, $predefined_groups[ $group_slug ] ) : $default_group;
          $return[ &#x27;groups&#x27; ][ $group_slug ] = WPP_F::extend( $default, array_filter( array(
            &#x27;label&#x27; =&gt; $data[ &#x27;name&#x27; ],
            &#x27;slug&#x27; =&gt; $group_slug,
          ) ) );
        }
      }
      foreach ( array_reverse( $predefined_groups ) as $k =&gt; $v ) {
        if ( !array_key_exists( $k, $return[ &#x27;groups&#x27; ] ) ) {
          $return[ &#x27;groups&#x27; ] = array( $k =&gt; array_merge( $default_group, $predefined_groups[ $k ] ) ) + $return[ &#x27;groups&#x27; ];
        }
      }

      //echo &quot;&lt;pre&gt;&quot;; print_r( $return ); echo &quot;&lt;/pre&gt;&quot;; die();

      return WPP_F::array_filter_deep( (array) $return );

    }

    /**
     * Return an array of all available attributes and meta keys
     *
     * @updated 1.36.1
     */
    static function get_total_attribute_array( $args = &#x27;&#x27;, $extra_values = array() ) {
      global $wp_properties, $wpdb;

      extract( wp_parse_args( $args, array( &#x27;use_optgroups&#x27; =&gt; &#x27;false&#x27; ) ), EXTR_SKIP );

      $property_stats = $wp_properties[ &#x27;property_stats&#x27; ];
      $property_groups = $wp_properties[ &#x27;property_groups&#x27; ];
      $property_stats_groups = $wp_properties[ &#x27;property_stats_groups&#x27; ];

      if ( $use_optgroups == &#x27;true&#x27; ) {

        foreach ( (array) $property_stats as $key =&gt; $attribute_label ) {

          if ( $property_stats_groups[ $key ] ) {
            $_group_slug = $property_stats_groups[ $key ];
            if ( isset( $property_groups[ $_group_slug ] ) ) {
              $_group_label = $property_groups[ $_group_slug ][ &#x27;name&#x27; ];
            }
          }

          $_group_label = $_group_label ? $_group_label : &#x27;Attributes&#x27;;
          $attributes[ $_group_label ][ $key ] = $attribute_label;

        }

        $attributes[ &#x27;Other&#x27; ] = $extra_values;

        $attributes = array_filter( (array) $attributes );

        foreach ( (array) $attributes as $_group_label =&gt; $_attribute_data ) {
          asort( $attributes[ $_group_label ] );
        }

      } else {
        $attributes = (array) $property_stats + (array) $extra_values;
      }

      $attributes = apply_filters( &#x27;wpp_total_attribute_array&#x27;, $attributes );

      if ( !is_array( $attributes ) ) {
        $attributes = array();
      }

      return $attributes;

    }

    /**
     * Returns attribute information.
     * Checks $wp_properties and returns a concise array of array-specific settings and attributes
     *
     * @TODO: need to compare the current version with the previous one ( WPP 1.36.X ). peshkov@UD
     *
     * @updated 2.0
     * @version 1.17.3
     */
    static function get_attribute_data( $attribute = false ) {
      global $wpdb, $wp_properties;

      $return = array();

      if ( !$attribute ) {
        return false;
      }

      if ( wp_cache_get( $attribute, &#x27;wpp_attribute_data&#x27; ) ) {
        return wp_cache_get( $attribute, &#x27;wpp_attribute_data&#x27; );
      }

      //** Set post table keys ( wp_posts columns ) */
      $post_table_keys = array();
      $columns = $wpdb-&gt;get_results( &quot;SELECT DISTINCT( column_name ) FROM information_schema.columns WHERE table_name = &#x27;{$wpdb-&gt;prefix}posts&#x27;&quot;, ARRAY_N );
      foreach ( $columns as $column ) {
        $post_table_keys[ ] = $column[ 0 ];
      }

      $ui_class = array( $attribute );

      $return[ &#x27;storage_type&#x27; ] = in_array( $attribute, (array) $post_table_keys ) ? &#x27;post_table&#x27; : &#x27;meta_key&#x27;;
      $return[ &#x27;slug&#x27; ] = $attribute;

      if ( isset( $wp_properties[ &#x27;property_stats_descriptions&#x27; ][ $attribute ] ) ) {
        $return[ &#x27;description&#x27; ] = $wp_properties[ &#x27;property_stats_descriptions&#x27; ][ $attribute ];
      }

      if ( isset( $wp_properties[ &#x27;property_stats_groups&#x27; ][ $attribute ] ) ) {
        $return[ &#x27;group_key&#x27; ] = $wp_properties[ &#x27;property_stats_groups&#x27; ][ $attribute ];
        $return[ &#x27;group_label&#x27; ] = $wp_properties[ &#x27;property_groups&#x27; ][ $wp_properties[ &#x27;property_stats_groups&#x27; ][ $attribute ] ][ &#x27;name&#x27; ];
      }

      $return[ &#x27;label&#x27; ] = $wp_properties[ &#x27;property_stats&#x27; ][ $attribute ];
      $return[ &#x27;classification&#x27; ] = !empty( $wp_properties[ &#x27;attribute_classification&#x27; ][ $attribute ] ) ? $wp_properties[ &#x27;attribute_classification&#x27; ][ $attribute ] : &#x27;string&#x27;;

      $return[ &#x27;is_stat&#x27; ] = ( !empty( $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $attribute ] ) &amp;&amp; $wp_properties[ &#x27;_attribute_classifications&#x27; ][ $attribute ] != &#x27;detail&#x27; ) ? &#x27;true&#x27; : &#x27;false&#x27;;

      if ( $return[ &#x27;is_stat&#x27; ] == &#x27;detail&#x27; ) {
        $return[ &#x27;input_type&#x27; ] = &#x27;textarea&#x27;;
      }

      $ui_class[ ] = &#x27;classification_&#x27; . $return[ &#x27;classification&#x27; ];

      if ( isset( $wp_properties[ &#x27;searchable_attr_fields&#x27; ][ $attribute ] ) ) {
        $return[ &#x27;input_type&#x27; ] = $wp_properties[ &#x27;searchable_attr_fields&#x27; ][ $attribute ];
        $ui_class[ ] = &#x27;search_&#x27; . $return[ &#x27;input_type&#x27; ];
      }

      if ( is_admin() &amp;&amp; isset( $wp_properties[ &#x27;admin_attr_fields&#x27; ][ $attribute ] ) ) {
        $return[ &#x27;data_input_type&#x27; ] = $wp_properties[ &#x27;admin_attr_fields&#x27; ][ $attribute ];
        $ui_class[ ] = &#x27;admin_&#x27; . $return[ &#x27;data_input_type&#x27; ];
      }

      if ( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;address_attribute&#x27; ] == $attribute ) {
        $return[ &#x27;is_address_attribute&#x27; ] = &#x27;true&#x27;;
        $ui_class[ ] = &#x27;address_attribute&#x27;;
      }

      foreach ( (array) $wp_properties[ &#x27;property_inheritance&#x27; ] as $property_type =&gt; $type_data ) {
        if ( in_array( $attribute, (array) $type_data ) ) {
          $return[ &#x27;inheritance&#x27; ][ ] = $property_type;
        }
      }

      $ui_class[ ] = $return[ &#x27;data_input_type&#x27; ];

      if ( is_array( $wp_properties[ &#x27;predefined_values&#x27; ] ) &amp;&amp; ( $predefined_values = $wp_properties[ &#x27;predefined_values&#x27; ][ $attribute ] ) ) {
        $return[ &#x27;predefined_values&#x27; ] = $predefined_values;
        $return[ &#x27;_values&#x27; ] = (array) $return[ &#x27;_values&#x27; ] + explode( &#x27;,&#x27;, $predefined_values );
      }

      if ( is_array( $wp_properties[ &#x27;predefined_search_values&#x27; ] ) &amp;&amp; ( $predefined_values = $wp_properties[ &#x27;predefined_search_values&#x27; ][ $attribute ] ) ) {
        $return[ &#x27;predefined_search_values&#x27; ] = $predefined_values;
        $return[ &#x27;_values&#x27; ] = (array) $return[ &#x27;_values&#x27; ] + explode( &#x27;,&#x27;, $predefined_values );
      }

      if ( is_array( $wp_properties[ &#x27;sortable_attributes&#x27; ] ) &amp;&amp; in_array( $attribute, (array) $wp_properties[ &#x27;sortable_attributes&#x27; ] ) ) {
        $return[ &#x27;sortable&#x27; ] = true;
        $ui_class[ ] = &#x27;sortable&#x27;;
      }

      if ( is_array( $wp_properties[ &#x27;searchable_attributes&#x27; ] ) &amp;&amp; in_array( $attribute, (array) $wp_properties[ &#x27;searchable_attributes&#x27; ] ) ) {
        $return[ &#x27;searchable&#x27; ] = true;
        $ui_class[ ] = &#x27;searchable&#x27;;
      }

      if ( is_array( $wp_properties[ &#x27;column_attributes&#x27; ] ) &amp;&amp; in_array( $attribute, (array) $wp_properties[ &#x27;column_attributes&#x27; ] ) ) {
        $return[ &#x27;in_overview&#x27; ] = true;
        $ui_class[ ] = &#x27;in_overview&#x27;;
      }

      if ( is_array( $wp_properties[ &#x27;disabled_attributes&#x27; ] ) &amp;&amp; in_array( $attribute, (array) $wp_properties[ &#x27;disabled_attributes&#x27; ] ) ) {
        $return[ &#x27;disabled&#x27; ] = true;
        $ui_class[ ] = &#x27;disabled&#x27;;
      }

      //** Legacy. numeric, boolean and currency params should not be used anywhere more. peshkov@UD */
      if ( $return[ &#x27;classification&#x27; ] == &#x27;admin_note&#x27; ) {
        $return[ &#x27;hidden_frontend_attribute&#x27; ] = true;
        $ui_class[ ] = &#x27;fe_hidden&#x27;;
      } else if ( $return[ &#x27;classification&#x27; ] == &#x27;currency&#x27; ) {
        $return[ &#x27;currency&#x27; ] = true;
        $return[ &#x27;numeric&#x27; ] = true;
      } else if ( $return[ &#x27;classification&#x27; ] == &#x27;area&#x27; ) {
        $return[ &#x27;numeric&#x27; ] = true;
      } else if ( $return[ &#x27;classification&#x27; ] == &#x27;boolean&#x27; ) {
        $return[ &#x27;boolean&#x27; ] = true;
      } else if ( $return[ &#x27;classification&#x27; ] == &#x27;numeric&#x27; ) {
        $return[ &#x27;numeric&#x27; ] = true;
      }

      if ( in_array( $attribute, array_keys( (array) $wp_properties[ &#x27;_predefined_attributes&#x27; ] ) ) ) {
        $return[ &#x27;standard&#x27; ] = true;
        $ui_class[ ] = &#x27;standard_attribute&#x27;;
      }

      if ( empty( $return[ &#x27;title&#x27; ] ) ) {
        $return[ &#x27;title&#x27; ] = WPP_F::de_slug( $return[ &#x27;slug&#x27; ] );
      }

      $ui_class = array_filter( array_unique( $ui_class ) );
      $ui_class = array_map( create_function( &#x27;$class&#x27;, &#x27;return &quot;wpp_{$class}&quot;;&#x27; ), $ui_class );
      $return[ &#x27;ui_class&#x27; ] = implode( &#x27; &#x27;, $ui_class );

      if ( is_array( $return[ &#x27;_values&#x27; ] ) ) {
        $return[ &#x27;_values&#x27; ] = array_unique( $return[ &#x27;_values&#x27; ] );
      }

      $return = apply_filters( &#x27;wpp_attribute_data&#x27;, array_filter( $return ) );

      wp_cache_add( $attribute, $return, &#x27;wpp_attribute_data&#x27; );

      return $return;

    }

    /**
     * Set all specific dynamic assets.
     *
     * @since 2.0
     * @version 1.0
     * @author peshkov@UD
     */
    static function set_assets() {
      global $wpp_asset;

      $uploads = wp_upload_dir();

      $less_default_variables = array(
        &#x27;version&#x27; =&gt; &quot;&#x27;&quot; . WPP_Version . &quot;&#x27;&quot;,
        &#x27;wpp_url&#x27; =&gt; &quot;&#x27;&quot; . str_replace( array( &#x27;http:&#x27;, &#x27;https:&#x27; ), &#x27;&#x27;, trailingslashit( WPP_URL ) ) . &quot;images&#x27;&quot;,
        &#x27;cdn_url&#x27; =&gt; &quot;&#x27;&quot; . str_replace( array( &#x27;http:&#x27;, &#x27;https:&#x27; ), &#x27;&#x27;, ( trailingslashit( defined( &#x27;UD_CDN_URL&#x27; ) ? UD_CDN_URL : &quot;//ud-cdn.com&quot; ) ) ) . &quot;assets&#x27;&quot;,
      );

      $assets = array(
        &#x27;admin_css&#x27; =&gt; array(
          &#x27;file&#x27; =&gt; trailingslashit( WPP_Path ) . &#x27;css/wpp.admin.min.css&#x27;,
          &#x27;type&#x27; =&gt; &#x27;css&#x27;,
          &#x27;compile_options&#x27; =&gt; array(
            &#x27;input&#x27; =&gt; trailingslashit( WPP_Path ) . &#x27;css/wpp.admin.less&#x27;,
            &#x27;variables&#x27; =&gt; $less_default_variables,
          )
        ),
        &#x27;global_js&#x27; =&gt; array(
          &#x27;file&#x27; =&gt; trailingslashit( WPP_Path ) . ( defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? &#x27;js/dev/wpp.global.js&#x27; : &#x27;js/wpp.global.js&#x27; ),
          &#x27;type&#x27; =&gt; &#x27;js&#x27;,
          &#x27;compile_options&#x27; =&gt; defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? false : array( &#x27;input&#x27; =&gt; array( trailingslashit( WPP_Path ) . &#x27;js/dev/wpp.global.js&#x27; ) )
        ),
        &#x27;admin_js&#x27; =&gt; array(
          &#x27;file&#x27; =&gt; trailingslashit( WPP_Path ) . ( defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? &#x27;js/dev/wpp.admin.js&#x27; : &#x27;js/wpp.admin.js&#x27; ),
          &#x27;type&#x27; =&gt; &#x27;js&#x27;,
          &#x27;compile_options&#x27; =&gt; defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? false : array( &#x27;input&#x27; =&gt; array( trailingslashit( WPP_Path ) . &#x27;js/dev/wpp.admin.js&#x27; ) )
        ),
        &#x27;admin_overview_js&#x27; =&gt; array(
          &#x27;file&#x27; =&gt; trailingslashit( WPP_Path ) . ( defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? &#x27;js/dev/wpp.admin.overview.js&#x27; : &#x27;js/wpp.admin.overview.js&#x27; ),
          &#x27;type&#x27; =&gt; &#x27;js&#x27;,
          &#x27;compile_options&#x27; =&gt; defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? false : array( &#x27;input&#x27; =&gt; array( trailingslashit( WPP_Path ) . &#x27;js/dev/wpp.admin.overview.js&#x27; ) )
        ),
        &#x27;admin_settings_js&#x27; =&gt; array(
          &#x27;file&#x27; =&gt; trailingslashit( WPP_Path ) . ( defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? &#x27;js/dev/wpp.admin.settings.js&#x27; : &#x27;js/wpp.admin.settings.js&#x27; ),
          &#x27;type&#x27; =&gt; &#x27;js&#x27;,
          &#x27;compile_options&#x27; =&gt; defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? false : array( &#x27;input&#x27; =&gt; array( trailingslashit( WPP_Path ) . &#x27;js/dev/wpp.admin.settings.js&#x27; ) )
        ),
        &#x27;admin_property_js&#x27; =&gt; array(
          &#x27;file&#x27; =&gt; trailingslashit( WPP_Path ) . ( defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? &#x27;js/dev/wpp.admin.property.js&#x27; : &#x27;js/wpp.admin.property.js&#x27; ),
          &#x27;type&#x27; =&gt; &#x27;js&#x27;,
          &#x27;compile_options&#x27; =&gt; defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? false : array( &#x27;input&#x27; =&gt; array( trailingslashit( WPP_Path ) . &#x27;js/dev/wpp.admin.property.js&#x27; ) )
        ),
        &#x27;admin_widgets_js&#x27; =&gt; array(
          &#x27;file&#x27; =&gt; trailingslashit( WPP_Path ) . ( defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? &#x27;js/dev/wpp.admin.widgets.js&#x27; : &#x27;js/wpp.admin.widgets.js&#x27; ),
          &#x27;type&#x27; =&gt; &#x27;js&#x27;,
          &#x27;compile_options&#x27; =&gt; defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? false : array( &#x27;input&#x27; =&gt; array( trailingslashit( WPP_Path ) . &#x27;js/dev/wpp.admin.widgets.js&#x27; ) )
        ),
        &#x27;admin_upgrade_js&#x27; =&gt; array(
          &#x27;file&#x27; =&gt; trailingslashit( WPP_Path ) . ( defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? &#x27;js/dev/wpp.admin.upgrade.js&#x27; : &#x27;js/wpp.admin.upgrade.js&#x27; ),
          &#x27;type&#x27; =&gt; &#x27;js&#x27;,
          &#x27;compile_options&#x27; =&gt; defined( &#x27;SCRIPT_DEBUG&#x27; ) &amp;&amp; SCRIPT_DEBUG ? false : array( &#x27;input&#x27; =&gt; array( trailingslashit( WPP_Path ) . &#x27;js/dev/wpp.admin.upgrade.js&#x27; ) )
        ),
        &#x27;app_js&#x27; =&gt; array(
          &#x27;file&#x27; =&gt; trailingslashit( $uploads[ &#x27;basedir&#x27; ] ) . &#x27;wpp_assets/wpp_app.js&#x27;,
          &#x27;type&#x27; =&gt; &#x27;js&#x27;,
          &#x27;compile_options&#x27; =&gt; array(
            &#x27;input&#x27; =&gt; array( trailingslashit( WPP_Path ) . &#x27;js/dev/wpp.global.js&#x27;, trailingslashit( WPP_Path ) . &#x27;js/dev/wpp.frontend.js&#x27;, )
          )
        ),
        &#x27;theme_default_css&#x27; =&gt; array(
          &#x27;file&#x27; =&gt; trailingslashit( $uploads[ &#x27;basedir&#x27; ] ) . &#x27;wpp_assets/wpp_theme_default.css&#x27;,
          &#x27;type&#x27; =&gt; &#x27;css&#x27;,
          &#x27;compile_options&#x27; =&gt; array(
            &#x27;input&#x27; =&gt; trailingslashit( WPP_Path ) . &#x27;templates/less/app.less&#x27;,
            &#x27;variables&#x27; =&gt; WPP_F::extend( $less_default_variables, array(
              &#x27;theme&#x27; =&gt; &quot;&#x27;default&#x27;&quot;,
              &#x27;legacy&#x27; =&gt; &#x27;true&#x27;,
            ) ),
          )
        ),
      );

      //** Get all available themes specific by parsing templates/less/themes directory. */
      $themes_specific = array();
      $dir = trailingslashit( WPP_Path ) . &#x27;templates/less/themes&#x27;;
      if ( is_dir( $dir ) ) {
        $files = scandir( $dir );
        foreach ( $files as $file ) {
          if ( !in_array( $file, array( &#x27;.&#x27;, &#x27;..&#x27; ) ) &amp;&amp; is_file( $dir . &#x27;/&#x27; . $file ) &amp;&amp; strpos( $file, &#x27;.less&#x27; ) !== false ) {
            $themes_specific[ ] = str_replace( &#x27;.less&#x27;, &#x27;&#x27;, $file );
          }
        }
      }

      //** Set assets for all themes specific */
      foreach ( $themes_specific as $theme ) {
        $assets[ &quot;theme_{$theme}_css&quot; ] = array(
          &#x27;file&#x27; =&gt; trailingslashit( $uploads[ &#x27;basedir&#x27; ] ) . &#x27;wpp_assets/wpp_theme_&#x27; . $theme . &#x27;.css&#x27;,
          &#x27;type&#x27; =&gt; &#x27;css&#x27;,
          &#x27;compile_options&#x27; =&gt; array(
            &#x27;input&#x27; =&gt; trailingslashit( WPP_Path ) . &#x27;templates/less/app.less&#x27;,
            &#x27;variables&#x27; =&gt; WPP_F::extend( $less_default_variables, array(
              &#x27;theme&#x27; =&gt; &quot;&#x27;&quot; . $theme . &quot;&#x27;&quot;,
              &#x27;legacy&#x27; =&gt; &#x27;true&#x27;,
            ) ),
          )
        );
      }

      $assets = apply_filters( &#x27;wpp::assets&#x27;, $assets );

      if ( is_array( $assets ) ) {
        return $wpp_asset-&gt;set_assets( $assets );
      } else {
        return false;
      }
    }

    /**
     * Merges classifications with default settings
     * Updates search/admin input data
     *
     * @uses self::_update_input_types()
     * @global array $wp_properties
     *
     * @param array $classifications
     *
     * @return array
     * @author peshkov@UD
     * @since 2.0
     */
    static function _update_attribute_classifications( $classifications ) {
      global $wp_properties;

      if ( !is_array( $classifications ) ) return $classifications;

      foreach ( $classifications as $k =&gt; $v ) {
        $classifications[ $k ][ &#x27;settings&#x27; ] = WPP_F::extend( array(
          &#x27;searchable&#x27; =&gt; true,
          &#x27;editable&#x27; =&gt; true,
          &#x27;admin_only&#x27; =&gt; false,
          &#x27;system&#x27; =&gt; false,
          &#x27;can_be_disabled&#x27; =&gt; false,
          &#x27;admin_predefined_values&#x27; =&gt; true,
          &#x27;search_predefined_values&#x27; =&gt; true,
        ), $v[ &#x27;settings&#x27; ] );

        //** Update input types data */
        if ( isset( $v[ &#x27;search&#x27; ] ) ) {
          $classifications[ $k ][ &#x27;search&#x27; ] = self::_update_input_types( $v[ &#x27;search&#x27; ] );
        }
        if ( isset( $v[ &#x27;admin&#x27; ] ) ) {
          $classifications[ $k ][ &#x27;admin&#x27; ] = self::_update_input_types( $v[ &#x27;admin&#x27; ] );
        }
      }

      return $classifications;
    }

    /**
     * Updates search/admin input types data.
     *
     * @global array $wp_properties
     *
     * @param array $types
     *
     * @return array
     * @author peshkov@UD
     * @since 2.0
     */
    static function _update_input_types( $types ) {
      global $wp_properties;

      if ( !empty( $wp_properties[ &#x27;_input_types&#x27; ] ) &amp;&amp; is_array( $types ) ) {
        $arr = array();
        foreach ( $types as $i =&gt; $label ) {
          if ( is_numeric( $i ) &amp;&amp; key_exists( $label, (array) $wp_properties[ &#x27;_input_types&#x27; ] ) ) {
            $arr[ $label ] = (array) $wp_properties[ &#x27;_input_types&#x27; ][ $label ];
          } else {
            $arr[ $i ] = $label;
          }
        }
        $types = $arr;
      }
      return $types;
    }

    /**
     * Adds taxonomies based on property attributes ( where classification is taxonomy )
     *
     * @since 2.0
     * @author peshkov@UD
     */
    static function _update_taxonomies( $taxonomies ) {
      global $wp_properties;

      if ( is_array( $taxonomies ) &amp;&amp; isset( $wp_properties[ &#x27;_data_structure&#x27; ][ &#x27;attributes&#x27; ] ) ) {
        foreach ( (array) $wp_properties[ &#x27;_data_structure&#x27; ][ &#x27;attributes&#x27; ] as $k =&gt; $v ) {
          if ( $v[ &#x27;classification&#x27; ] === &#x27;taxonomy&#x27; &amp;&amp; !isset( $taxonomies[ $k ] ) ) {
            $taxonomies[ $k ] = array(
              &#x27;label&#x27; =&gt; $v[ &#x27;label&#x27; ]
            );
          }
        }
      }

      return $taxonomies;
    }

    /**
     * Localization functionality.
     * Replaces array&#x27;s l10n data.
     * Helpful for localization of data which is stored in JSON files ( see /schemas )
     *
     * @param type $data
     *
     * @return type
     * @since 2.0
     * @author peshkov@UD
     */
    static function _localize( $data ) {

      if ( !is_array( $data ) ) return $data;

      //** The Localization&#x27;s list. */
      $l10n = apply_filters( &#x27;wpp::config::l10n&#x27;, array(
        //** System (wp_posts) data */
        &#x27;post_title&#x27; =&gt; sprintf( __( &#x27;%1$s Title&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &#x27;singular&#x27; ) ) ),
        &#x27;post_type&#x27; =&gt; __( &#x27;Post Type&#x27; ),
        &#x27;post_content&#x27; =&gt; sprintf( __( &#x27;%1$s Content&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &#x27;singular&#x27; ) ) ),
        &#x27;post_excerpt&#x27; =&gt; sprintf( __( &#x27;%1$s Excerpt&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &#x27;singular&#x27; ) ) ),
        &#x27;post_status&#x27; =&gt; sprintf( __( &#x27;%1$s Status&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &#x27;singular&#x27; ) ) ),
        &#x27;menu_order&#x27; =&gt; sprintf( __( &#x27;%1$s Order&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &#x27;singular&#x27; ) ) ),
        &#x27;post_date&#x27; =&gt; sprintf( __( &#x27;%1$s Date&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &quot;singular&quot; ) ) ),
        &#x27;post_author&#x27; =&gt; sprintf( __( &#x27;%1$s Author&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &quot;singular&quot; ) ) ),
        &#x27;post_date_gmt&#x27; =&gt; sprintf( __( &#x27;%1$s Date GMT&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &quot;singular&quot; ) ) ),
        &#x27;post_parent&#x27; =&gt; sprintf( __( &#x27;%1$s Parent&#x27;, &#x27;wpp&#x27; ), ucfirst( WPP_F::property_label( &quot;singular&quot; ) ) ),
        &#x27;ping_status&#x27; =&gt; __( &#x27;Ping Status&#x27;, &#x27;wpp&#x27; ),
        &#x27;comment_status&#x27; =&gt; __( &#x27;Comment\&#x27;s Status&#x27;, &#x27;wpp&#x27; ),
        &#x27;post_password&#x27; =&gt; __( &#x27;Password&#x27;, &#x27;wpp&#x27; ),

        //** Attributes Groups */
        &#x27;main&#x27; =&gt; __( &#x27;General Information&#x27;, &#x27;wpp&#x27; ),

        //** Attributes and their descriptions */
        &#x27;price&#x27; =&gt; __( &#x27;Price&#x27;, &#x27;wpp&#x27; ),
        &#x27;price_desc&#x27; =&gt; __( &#x27;Numbers only&#x27;, &#x27;wpp&#x27; ),
        &#x27;bedrooms&#x27; =&gt; __( &#x27;Bedrooms&#x27;, &#x27;wpp&#x27; ),
        &#x27;bedrooms_desc&#x27; =&gt; __( &#x27;Numbers only&#x27;, &#x27;wpp&#x27; ),
        &#x27;bathrooms&#x27; =&gt; __( &#x27;Bathrooms&#x27;, &#x27;wpp&#x27; ),
        &#x27;bathrooms_desc&#x27; =&gt; __( &#x27;Numbers only&#x27;, &#x27;wpp&#x27; ),
        &#x27;phone_number&#x27; =&gt; __( &#x27;Phone Number&#x27;, &#x27;wpp&#x27; ),
        &#x27;phone_number_desc&#x27; =&gt; __( &#x27;&#x27;, &#x27;wpp&#x27; ),
        &#x27;address&#x27; =&gt; __( &#x27;Address&#x27;, &#x27;wpp&#x27; ),
        &#x27;address_desc&#x27; =&gt; __( &#x27;Used by google validator&#x27;, &#x27;wpp&#x27; ),
        &#x27;area&#x27; =&gt; __( &#x27;Area&#x27;, &#x27;wpp&#x27; ),
        &#x27;area_desc&#x27; =&gt; __( &#x27;Numbers only&#x27;, &#x27;wpp&#x27; ),
        &#x27;deposit&#x27; =&gt; __( &#x27;Deposit&#x27;, &#x27;wpp&#x27; ),
        &#x27;deposit_desc&#x27; =&gt; __( &#x27;Numbers only&#x27;, &#x27;wpp&#x27; ),
        &#x27;geo_location&#x27; =&gt; __( &#x27;Geo Location&#x27;, &#x27;wpp&#x27; ),
        &#x27;taxonomy&#x27; =&gt; __( &#x27;Taxonomy&#x27;, &#x27;wpp&#x27; ),

        //** Property Types */
        &#x27;single_family_home&#x27; =&gt; __( &#x27;Single Family Home&#x27;, &#x27;wpp&#x27; ),
        &#x27;building&#x27; =&gt; __( &#x27;Building&#x27;, &#x27;wpp&#x27; ),
        &#x27;floorplan&#x27; =&gt; __( &#x27;Floorplan&#x27;, &#x27;wpp&#x27; ),
        &#x27;farm&#x27; =&gt; __( &#x27;Farm&#x27;, &#x27;wpp&#x27; ),

        //** Input types */
        &#x27;field_input&#x27; =&gt; __( &#x27;Free Text&#x27;, &#x27;wpp&#x27; ),
        &#x27;field_dropdown&#x27; =&gt; __( &#x27;Dropdown Selection&#x27;, &#x27;wpp&#x27; ),
        &#x27;field_textarea&#x27; =&gt; __( &#x27;Textarea&#x27;, &#x27;wpp&#x27; ),
        &#x27;field_checkbox&#x27; =&gt; __( &#x27;Checkbox&#x27;, &#x27;wpp&#x27; ),
        &#x27;field_multi_checkbox&#x27; =&gt; __( &#x27;Multi-Checkbox&#x27;, &#x27;wpp&#x27; ),
        &#x27;field_range_input&#x27; =&gt; __( &#x27;Text Input Range&#x27;, &#x27;wpp&#x27; ),
        &#x27;field_range_dropdown&#x27; =&gt; __( &#x27;Range Dropdown&#x27;, &#x27;wpp&#x27; ),
        &#x27;field_date&#x27; =&gt; __( &#x27;Date Picker&#x27;, &#x27;wpp&#x27; ),
        &#x27;range_date&#x27; =&gt; __( &#x27;Range Date Picker&#x27;, &#x27;wpp&#x27; ),

        //** Attributes Classifications */
        &#x27;short_text&#x27; =&gt; __( &#x27;Short Text&#x27;, &#x27;wpp&#x27; ),
        &#x27;used_for_short_desc&#x27; =&gt; __( &#x27;Best used for short phrases and descriptions&#x27;, &#x27;wpp&#x27; ),
      ) );

      //** Replace l10n entries */
      foreach ( $data as $k =&gt; $v ) {
        if ( is_array( $v ) ) {
          $data[ $k ] = self::_localize( $v );
        } elseif ( is_string( $v ) ) {
          if ( strpos( $v, &#x27;l10n&#x27; ) !== false ) {
            preg_match_all( &#x27;/l10n\.([^\s]*)/&#x27;, $v, $matches );
            if ( !empty( $matches[ 1 ] ) ) {
              foreach ( $matches[ 1 ] as $i =&gt; $m ) {
                if ( key_exists( $m, $l10n ) ) {
                  $data[ $k ] = str_replace( $matches[ 0 ][ $i ], $l10n[ $m ], $data[ $k ] );
                }
              }
            }
          }
        }
      }

      return $data;
    }

  }

}
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
