# WordPress Network
#
# Examples:
# * http://capitaldealsonline.com/assets/scripts/admin-bar.js
# * http://capitaldealsonline.com/assets/styles/admin-bar.css
#
# @version 0.6.8
# @author potanin@UD

# Required at beginning
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
</IfModule>

# BEGIN Mimes
<IfModule mod_mime.c>
  AddEncoding gzip svgz
  AddType audio/mp4 m4a f4a f4b
  AddType audio/ogg oga ogg
  AddType application/javascript js
  AddType application/json json
  AddType video/mp4 mp4 m4v f4v f4p
  AddType video/ogg ogv
  AddType video/webm webm
  AddType video/x-flv flv
  AddType application/font-woff woff
  AddType application/vnd.ms-fontobject eot
  AddType application/x-font-ttf ttc ttf
  AddType font/opentype otf
  AddType application/octet-stream safariextz
  AddType application/x-chrome-extension crx
  AddType application/x-opera-extension oex
  AddType application/x-shockwave-flash swf
  AddType application/x-web-app-manifest+json webapp
  AddType application/x-xpinstall xpi
  AddType application/xml atom rdf rss xml
  AddType image/webp webp
  AddType image/x-icon ico
  AddType text/cache-manifest appcache manifest
  AddType text/vtt vtt
  AddType text/x-component htc
  AddType text/x-vcard vcf
</IfModule>
# END Mimes

# BEGIN Format
<IfModule mod_mime.c>
  AddCharset utf-8 .atom .css .js .json .rss .vtt .webapp .xml .html .htm
</IfModule>
# END Format

# BEGIN Security
<FilesMatch "(^#.*#|\.(md|lock|yml|json|bak|config|dist|fla|inc|ini|log|psd|sh|sql|sw[op])|~)$">
  Order allow,deny
  Deny from all
  Satisfy All
</FilesMatch>
# END Security

# BEGIN Static Cache
<IfModule mod_headers.c>

  <FilesMatch "\.(ttf|ttc|otf|eot|woff|font.css)$">
    Header set Cache-Control "max-age=290304000, public"
    Header set Expires "Thu, 15 Apr 2015 20:00:00 GMT"
    Header set Access-Control-Allow-Origin "*"
  </FilesMatch>

  <FilesMatch "\.(js|css)$">
    Header set Cache-Control "public, max-age=290304000"
    Header set Expires "Thu, 15 Apr 2015 20:00:00 GMT"
  </FilesMatch>

  <FilesMatch "\.(xml|json)$">
    Header set Cache-Control "public, must-revalidate, max-age=172800"
  </FilesMatch>

  <FilesMatch "\.(html|htm)$">
    Header set Cache-Control "max-age=7200, must-revalidate"
    Header set Access-Control-Allow-Origin "*"
  </FilesMatch>

</IfModule>
# END Static Cache

# BEGIN Veneer Static Media
RewriteEngine On
RewriteBase /
RewriteRule ^wp-content/uploads/(.*)$ /media/$1 [L]
RewriteRule ^system/files/(.*)$ /media/$1 [L]
RewriteRule ^system/media/(.*)$ /media/$1 [L]
RewriteRule ^files/(.*)$ /media/$1 [L]
RewriteRule ^uploads/(.*)$ /media/$1 [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{HTTP_HOST}::%{REQUEST_URI} ^(.*)::/(.*)$
RewriteCond %{DOCUMENT_ROOT}/storage/%1/static/%2 -f
RewriteRule ^(.*) /storage/%1/static/%2 [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{HTTP_HOST}::%{REQUEST_URI} ^(.*)::/(.*)$
RewriteCond %{DOCUMENT_ROOT}/storage/%1/%2 -f
RewriteRule ^.*$ /storage/%1/%2 [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{HTTP_HOST}::%{REQUEST_URI} ^(assets|media|cache|static)\.(.*)::/(?:assets|media|cache|static)?/?(.*)$
RewriteCond %{DOCUMENT_ROOT}/storage/%2/%1/%3 -f
RewriteRule ^.*$ /storage/%2/%1/%3 [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{HTTP_HOST}::%{REQUEST_URI} ^(.*)::/(.*)$
RewriteCond %{DOCUMENT_ROOT}/storage/%1/static/%2index.html -f
RewriteRule ^.*$ /storage/%1/static/%2index.html [NC,QSA,L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{HTTP_HOST}::%{REQUEST_URI} ^(.*)::/(.*)$
RewriteCond %{DOCUMENT_ROOT}/storage/%1/static/%2.html -f
RewriteRule ^.*$ /storage/%1/static/%2.html [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{DOCUMENT_ROOT}/storage/%{HTTP_HOST}/static/index\.html -f
RewriteCond %{QUERY_STRING} ^$
RewriteRule ^$ /storage/%{HTTP_HOST}/static/index.html [L]
# END Veneer Static Media

# BEGIN Veneer Assets
RewriteEngine On
RewriteBase /
RewriteRule ^includes/js/(.*)$ /assets/scripts/$1 [QSA,L]
RewriteRule ^includes/css/(.*)$ /assets/styles/$1 [QSA,L]
RewriteRule ^wp-includes/js/(.*)$ /assets/scripts/$1 [QSA,L]
RewriteRule ^wp-includes/images/(.*)$ /assets/images/$1 [QSA,L]
RewriteRule ^wp-includes/css/(.*)$ /assets/styles/$1 [R=301,L]
RewriteRule ^assets/styles/(.*)$ /wp-includes/css/$1 [QSA,L]
RewriteRule ^assets/scripts/(.*)$ /wp-includes/js/$1 [QSA,L]
RewriteRule ^assets/images/(.*)$ /wp-includes/images/$1 [QSA,L]
# END Veneer Assets

# BEGIN Veneer Management Access 
RewriteEngine On
RewriteBase /
# RewriteRule ^wp-admin/admin-ajax.php?(.*)$  /wp-admin/admin-ajax.php$1  [QSA,L]
# RewriteRule ^wp-admin/admin-ajax.php?(.*)$  /wp-admin/admin-ajax.php$1  [QSA,L]
# RewriteRule ^wp-admin/js/?(.*)$             /manage/js/$1           [QSA,L]
# RewriteRule ^wp-admin/css/?(.*)$            /manage/css/$1          [QSA,L]
# RewriteRule ^wp-admin/images/?(.*)$         /manage/images/$1       [QSA,L]
# RewriteRule ^wp-login.php$                  /manage/login/          [R=301,L]
# RewriteRule ^wp-admin$                      /manage/                [R=301,L]
# RewriteRule ^wp-admin/install.php?(.*)$     /manage/install.php$1   [R=301,L]
# RewriteRule ^manage$                         /manage/ [R=301,L]
# RewriteRule ^manage/(login|signup)/?(.*)$    /wp-$1.php [QSA,L]
# RewriteRule ^manage/?(.*)$                   /wp-admin/$1 [QSA,L]
# RewriteRule ^wp-vendor/libraries/automattic/wordpress/manage/?(.*)$ /manage/$1 [QSA,L]
# RewriteRule ^wp-admin/load-styles.php?(.*)$ /wp-admin/load-styles.php$1 [QSA,L]
# RewriteRule ^wp-admin/load-scripts.php?(.*)$ /wp-admin/load-scripts.php$1 [R=301,L]
# END Veneer Management Access 

# BEGIN Veneer Public API
RewriteEngine On
RewriteBase /
RewriteCond %{HTTP_HOST}          ^api\..*$
RewriteRule ^documents/v1/(.*)$   http://api.veneer.io/documents/$1 [P,L]
RewriteCond %{HTTP_HOST}          ^api\..*$
RewriteRule ^search/v1/(.*)$      http://api.veneer.io/search/$1 [P,L]
RewriteCond %{HTTP_HOST}          ^api\..*$
RewriteRule ^documents/(.*)$      http://api.veneer.io/documents/$1 [P,L]
RewriteCond %{HTTP_HOST}          ^api\..*$
RewriteRule ^search/(.*)$         http://api.veneer.io/search/$1 [P,L]
# END Veneer Public API

# BEGIN Veneer WordPress API
RewriteEngine On
RewriteBase /
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^.*admin-ajax\.php.*$
RewriteRule ^xmlrpc.php$ //xmlrpc.php [QSA,L]
RewriteRule ^api/rpc.xml$ //xmlrpc.php [QSA,L]
RewriteRule ^api/rpc.json$ /wp-admin/admin-ajax.php?action=/api/json-rpc [QSA,L]
RewriteRule ^api/(.*).xml$ /wp-admin/admin-ajax.php?action=/$1&format=xml [QSA,L]
RewriteRule ^api/(.*).json$ /wp-admin/admin-ajax.php?action=/$1&format=json [QSA,L]
# END Veneer WordPress API


# BEGIN WordPress
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  RewriteRule ^index\.php$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.php [L]
</IfModule>
# END WordPress
