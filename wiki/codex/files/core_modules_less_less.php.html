<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/modules/less/less.php - Flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="Flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Functions.html">Template Functions</a></li>
            
                <li><a href="../classes/Theme UI.html">Theme UI</a></li>
            
                <li><a href="../classes/UD_API.html">UD_API</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Core Assets.html">Core Assets</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/modules/less/less.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php
/**
 * Name: Flawless LESS Handler
 * Version: 1.0
 * Description: Extends lessphp.
 * Author: Usability Dynamics, Inc.
 * Theme Feature: less-css
 *
 *
 * =Documentation=
 * If the feature is enabled, on every page load the Flawless::build_compiled_css() is called which in turn calls flawless_class,
 * which processes /less/bootstrap.less, files references form within, as well as all enqueued front-end CSS files.
 * A reference to all includes files is saved in option &quot;flawless::compiled_css_files&quot;
 *
 * If one of the files has a a newer modification time than the compiled CSS files, then the compiled file is re-generated.
 * which are saved to the stylesheet directory, which is either the child theme, or the parent theme.
 *
 * When succssful, Flawless generates two files, bootstrap-compiled.css and bootstrap-compiled.min.css.
 *
 * =Developer Notes=
 * The file checking occurs at the wp_print_styles (0) action, since all the enqued styles must be known at that point.
 *
 * $flawless[ &#x27;_bootstrap_compiled_url&#x27; ] - URL to compiled CSS file.
 * $flawless[ &#x27;_bootstrap_compiled_path&#x27; ] - URL to compiled CSS file.
 * $flawless[ &#x27;_bootstrap_compiled_minified_path&#x27; ] - File path to minified compiled CSS file
 * $flawless[ &#x27;_bootstrap_compiled_minified_url&#x27; ] - URL to minified CSS file.
 *
 */

Flawless::load( &#x27;lessc.inc&#x27; );

if ( !class_exists( &#x27;lessc&#x27; ) ) {
  return;
}

class flawless_less extends lessc {

  /**
   * Initializer.
   *
   * @since Flawless 0.6.1
   */
  function __construct() {

    //** On initial call, we need to initialize the feature via hooks */
    if ( !did_action( &#x27;flawless::available_theme_features&#x27; ) ) {
      return flawless_less::initialize();
    }

  }

  /**
   * Feature Initializer
   *
   * @since Flawless 0.6.1
   */
  function initialize() {

    /**
     * Add Frontend Editor as a Theme Feature. If already declared as Available Theme Feature, the exiting value takes presedence.
     *
     * @since Flawless 0.6.1
     */
    add_filter( &#x27;flawless::available_theme_features&#x27;, function ( $features ) {
      return array_merge( array( &#x27;less-css&#x27; =&gt; true ), (array)$features );
    } );

    /**
     * {missing description}
     *
     * @todo admin_bar_menu should be using Flawless::add_to_navbar() which should then add the Editor link to the appropriate Navbar. - potanin@UD 6/9/2012
     * @since Flawless 0.6.1
     */
    add_action( &#x27;flawless::theme_setup::after&#x27;, function () {

      if ( !current_theme_supports( &#x27;less-css&#x27; ) ) {
        return;
      }

    }, 200 );

  }

  /**
   * Compile LESS
   *
   * @param $paths
   * @param array $args
   * @return string|WP_Error
   */
  public function compile( $paths, $args = array() ) {
    global $flawless;

    $args = wp_parse_args( $form_data, array(
      &#x27;formatter&#x27; =&gt; false,
      &#x27;debug&#x27; =&gt; WP_DEBUG,
      &#x27;tidy&#x27; =&gt; true,
      &#x27;minify&#x27; =&gt; true
    ) );

    foreach ( (array)$paths as $path ) {
      $_contents .= file_get_contents( $path );
    }

    try {
      $_less = new lessc();

      $_less-&gt;importDir[ ] = untrailingslashit( get_stylesheet_directory() ) . &#x27;/less&#x27;;
      $_less-&gt;importDir[ ] = untrailingslashit( get_template_directory() ) . &#x27;/less&#x27;;
      $_less-&gt;importDir[ ] = untrailingslashit( get_stylesheet_directory() ) . &#x27;/css&#x27;;
      $_less-&gt;importDir[ ] = untrailingslashit( get_template_directory() ) . &#x27;/css&#x27;;

      if ( $args[ &#x27;formatter&#x27; ] ) {
        $_less-&gt;setFormatter( $args[ &#x27;formatter&#x27; ] );
      }

      foreach ( (array)$flawless[ &#x27;css_options&#x27; ] as $name =&gt; $option ) {
        $_less_variables[ &#x27;@&#x27; . $name ] = $option[ &#x27;value&#x27; ] . &#x27;;&#x27;;
      }

      if ( $args[ &#x27;debug&#x27; ] ) {
        $code[ &#x27;parsed&#x27; ] = $_less-&gt;parse( $_contents, $_less_variables );
      } else {
        $code[ &#x27;parsed&#x27; ] = @$_less-&gt;parse( $_contents, $_less_variables );
      }

    } catch ( exception $ex ) {
      return new WP_Error( &#x27;compile_error&#x27;, $ex-&gt;getMessage() );
    }

    if ( $args[ &#x27;tidy&#x27; ] &amp;&amp; ( class_exists( &#x27;csstidy&#x27; ) || file_exists( untrailingslashit( get_template_directory() ) . &#x27;/core/libs/csstidy/class.csstidy.php&#x27; ) ) ) {

      include_once untrailingslashit( get_template_directory() ) . &#x27;/core/libs/csstidy/class.csstidy.php&#x27;;

      if ( class_exists( &#x27;csstidy&#x27; ) ) {
        $css = new csstidy();
        $css-&gt;load_template( untrailingslashit( get_template_directory() ) . &#x27;/core/libs/csstidy/template.tpl&#x27; );
        $data = $css-&gt;parse( $code[ &#x27;parsed&#x27; ] );
        $code[ &#x27;formatted&#x27; ] = $css-&gt;print-&gt;plain();
      }
    }

    if ( $args[ &#x27;minify&#x27; ] &amp;&amp; ( class_exists( &#x27;CssMin&#x27; ) || Flawless::load( &#x27;CssMin&#x27; ) ) ) {
      $code[ &#x27;minified&#x27; ] = CssMin::minify( $code[ &#x27;parsed&#x27; ] );
    }

    return $code;

  }

}

$flawless_less = new flawless_less();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
