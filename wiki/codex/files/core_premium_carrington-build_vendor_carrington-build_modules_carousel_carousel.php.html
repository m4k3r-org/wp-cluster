<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/premium/carrington-build/vendor/carrington-build/modules/carousel/carousel.php - Flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="Flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/: Flawless.Element.html">: Flawless.Element</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Module.html">: Flawless.Flawless_Module</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Shortcode.html">: Flawless.Flawless_Shortcode</a></li>
            
                <li><a href="../classes/: Flawless.Flawless_Widget.html">: Flawless.Flawless_Widget</a></li>
            
                <li><a href="../classes/: Flawless.License.html">: Flawless.License</a></li>
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Functions.html">Template Functions</a></li>
            
                <li><a href="../classes/Template Methods.html">Template Methods</a></li>
            
                <li><a href="../classes/Theme UI.html">Theme UI</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Core Assets.html">Core Assets</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/premium/carrington-build/vendor/carrington-build/modules/carousel/carousel.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php

if (!class_exists(&#x27;cfct_module_carousel&#x27;) &amp;&amp; class_exists(&#x27;cfct_build_module&#x27;)) {
  class cfct_module_carousel extends cfct_build_module {
    protected $context_excludes = array(
      &#x27;multi-module&#x27;
    );
    
    protected $js_base = &#x27;cfct_car&#x27;;
    
    public function __construct() {
      $opts = array(
        &#x27;description&#x27; =&gt; __(&#x27;Display an Image Carousel&#x27;, &#x27;carrington-build&#x27;),
        &#x27;icon&#x27; =&gt; &#x27;carousel/icon.png&#x27;
      );
      parent::__construct(&#x27;cfct-module-carousel&#x27;, __(&#x27;Carousel&#x27;, &#x27;carrington-build&#x27;), $opts);
      add_filter(&#x27;wp_ajax_cfct_carousel_post_search&#x27;, array($this, &#x27;_handle_carousel_request&#x27;));
      
      wp_register_script(&#x27;jquery-cycle&#x27;, $this-&gt;get_url().&#x27;js/jquery.cycle.js&#x27;, array(&#x27;jquery&#x27;), &#x27;1.0&#x27;);
      
      if (!is_admin()) {
        wp_enqueue_script(&#x27;jquery-cycle&#x27;);
      }
      
      // this is but a small subset of what the JS can do
      // but this is the &quot;good&quot; stuff, the rest is weird or fluffy
      $this-&gt;transitions = apply_filters(&#x27;cfct-carousel-transitions-options&#x27;, array(
        &#x27;none&#x27; =&gt; &#x27;No transition effect&#x27;,
        &#x27;fade&#x27; =&gt; &#x27;Fade between images&#x27;,
        &#x27;scrollHorz&#x27; =&gt; &#x27;Scroll images left or right, per position&#x27;,
        &#x27;scrollVert&#x27; =&gt; &#x27;Scroll images up or down, per position&#x27;,
        &#x27;cover&#x27; =&gt; &#x27;Slide new image in on top&#x27;,
        &#x27;uncover&#x27; =&gt; &#x27;Slide old image off of top&#x27;
      ));
      
      $this-&gt;nav_positions = apply_filters(&#x27;cfct-carousel-nav-positions&#x27;, array(
        &#x27;before&#x27; =&gt; &#x27;Before Carousel&#x27;,
        &#x27;after&#x27; =&gt; &#x27;After Carousel&#x27;,
        &#x27;overlay&#x27; =&gt; &#x27;Inside Overlay&#x27;
      ));
    }

// Display
    
    /**
     * contains capacity to have pre-defined links &amp; image urls,
     * though that functionality is not exposed in the admin
     *
     * @param string $data 
     * @return void
     */
    public function display($data) {
      $image_size = $data[$this-&gt;get_field_name(&#x27;image_size-size&#x27;)];

      // walk items to make sure they&#x27;re all valid
      $items = array();
      foreach ($data[$this-&gt;get_field_name(&#x27;posts&#x27;)] as $item) {
        if (empty($item[&#x27;link&#x27;])) {
          $item[&#x27;link&#x27;] = get_permalink($item[&#x27;id&#x27;]);
        }
        
        if (empty($item[&#x27;img_src&#x27;])) {
          $_img = $_img_id = null;
          $_img_id = get_post_meta($item[&#x27;id&#x27;], &#x27;_thumbnail_id&#x27;, true);
          if (!empty($_img_id) &amp;&amp; $_img = wp_get_attachment_image_src($_img_id, $image_size, false)) {
            $item[&#x27;img_src&#x27;] = $_img;
          }
        }
        
        // last chance for an image
        if (!empty($item[&#x27;img_src&#x27;])) {
          $items[] = $item;
        }
      }
            
      $control_layout_order = apply_filters($this-&gt;id_base.&#x27;-control-layout-order&#x27;, array(
        &#x27;title&#x27;,
        &#x27;description&#x27;,
        &#x27;call-to-action&#x27;,
        &#x27;pagination&#x27;
      ));
      
      // carousel defaults
      $car_opts = array(
        &#x27;link_images&#x27; =&gt; !empty($data[$this-&gt;get_field_name(&#x27;link_images&#x27;)]) ? true : false,
        &#x27;height&#x27; =&gt; intval($data[$this-&gt;get_field_name(&#x27;height&#x27;)]),
        &#x27;nav_pos&#x27; =&gt; esc_attr($data[$this-&gt;get_field_name(&#x27;nav_pos&#x27;)]),
        &#x27;nav_element&#x27; =&gt; apply_filters(&#x27;cfct-carousel-nav-element&#x27;, &#x27;&lt;div class=&quot;car-pagination&quot;&gt;&lt;ol&gt;&lt;/ol&gt;&lt;/div&gt;&#x27;),
        &#x27;nav_selector&#x27; =&gt; apply_filters(&#x27;cfct-carousel-nav-selector&#x27;, &#x27;#carousel-&#x27;.$data[&#x27;module_id&#x27;].&#x27; .car-pagination ol&#x27;, &#x27;#carousel-&#x27;.$data[&#x27;module_id&#x27;])
      );
      
      // Make sure you quote string values - this distinguishes them from object literals
      $js_opts = apply_filters(&#x27;cfct-carousel-js-options&#x27;, array(
        &#x27;fx&#x27; =&gt; &#x27;&quot;&#x27; . esc_attr($data[$this-&gt;get_field_name(&#x27;transition&#x27;)]) . &#x27;&quot;&#x27;,
        &#x27;speed&#x27; =&gt; abs(intval($data[$this-&gt;get_field_name(&#x27;transition_duration&#x27;)])),
        &#x27;timeout&#x27; =&gt; abs(intval($data[$this-&gt;get_field_name(&#x27;auto_scroll&#x27;)])),
        &#x27;pager&#x27; =&gt; &#x27;&quot;&#x27; . $car_opts[&#x27;nav_selector&#x27;] . &#x27;&quot;&#x27;,
        &#x27;activePagerClass&#x27; =&gt; &#x27;&quot;active&quot;&#x27;,
        // Pause when hovering over nav
        &#x27;pauseOnPagerHover&#x27; =&gt; &#x27;true&#x27;,
        // Pause when hovering over slider
        &#x27;pause&#x27; =&gt; &#x27;true&#x27;,
        &#x27;prev&#x27; =&gt; &#x27;$(\&#x27;&lt;a class=&quot;cfct-carousel-prev&quot;&gt;&#x27;.__(&#x27;Prev&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/a&gt;\&#x27;).insertBefore(&quot;&#x27;.$car_opts[&#x27;nav_selector&#x27;].&#x27;&quot;)&#x27;,
        &#x27;next&#x27; =&gt; &#x27;$(\&#x27;&lt;a class=&quot;cfct-carousel-next&quot;&gt;&#x27;.__(&#x27;Next&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/a&gt;\&#x27;).insertAfter(&quot;&#x27;.$car_opts[&#x27;nav_selector&#x27;].&#x27;&quot;)&#x27;,
        // Callback for changing pane content
        &#x27;before&#x27; =&gt; &#x27;cfctCarousel.PagerClick&#x27;,
        &#x27;pagerAnchorBuilder&#x27; =&gt; &#x27;cfctCarousel.PagerAnchorBuilder&#x27;
      ), $car_opts);
      
      // Don&#x27;t use json_encode because it quotes object literals, turning them into strings.
      $jobj = array();
      foreach ($js_opts as $key =&gt; $value) {
        $jobj[] = $key . &#x27;:&#x27; . $value;
      }
      $jobj = &#x27;{&#x27; . implode(&#x27;,&#x27;, $jobj) . &#x27; }&#x27;;
      
      $js_init = apply_filters(&#x27;cfct-carousel-js-init&#x27;, &#x27;
      &lt;script type=&quot;text/javascript&quot;&gt;
        jQuery(function($) {
          $(&quot;#carousel-&#x27;.$data[&#x27;module_id&#x27;].&#x27; .car-content ul&quot;).cycle(&#x27;.$jobj.&#x27;);
        });
      &lt;/script&gt;&#x27;, $data[&#x27;module_id&#x27;], $car_opts, $js_opts);
  
      return $this-&gt;load_view($data, compact(&#x27;items&#x27;, &#x27;control_layout_order&#x27;, &#x27;image_size&#x27;, &#x27;car_opts&#x27;, &#x27;js_init&#x27;));
    }
    
// Admin

    public function text($data) {
      return &#x27;Carousel&#x27;;
    }
    
    public function admin_form($data) {
      $size_select_args = array(
        &#x27;field_name&#x27; =&gt; &#x27;image_size&#x27;,
        &#x27;selected_size&#x27; =&gt; (!empty($data[$this-&gt;get_field_name(&#x27;image_size-size&#x27;)]) ? $data[$this-&gt;get_field_name(&#x27;image_size-size&#x27;)] : &#x27;large&#x27;)
      );
      
      $tabs = array(
        &#x27;car-items&#x27; =&gt; &#x27;Items&#x27;,
        &#x27;car-settings&#x27; =&gt; &#x27;Settings&#x27;
      );
      
      $transition_duration = !empty($data[$this-&gt;get_field_name(&#x27;transition_duration&#x27;)]) ? $data[$this-&gt;get_field_name(&#x27;transition_duration&#x27;)] : 300;
      $auto_scroll = !empty($data[$this-&gt;get_field_name(&#x27;auto_scroll&#x27;)]) ? $data[$this-&gt;get_field_name(&#x27;auto_scroll&#x27;)] : 0;
      $carousel_height = !empty($data[$this-&gt;get_field_name(&#x27;height&#x27;)]) ? $data[$this-&gt;get_field_name(&#x27;height&#x27;)] : &#x27;&#x27;;
      $nav_pos = !empty($data[$this-&gt;get_field_name(&#x27;nav_pos&#x27;)]) ? $data[$this-&gt;get_field_name(&#x27;nav_pos&#x27;)] : &#x27;after&#x27;;
      
      $html = $this-&gt;cfct_module_tabs(&#x27;cfct-car-tabs&#x27;, $tabs, &#x27;car-items&#x27;).&#x27;
        &lt;div id=&quot;cfct-car-tab-containers&quot; class=&quot;cfct-module-tab-contents&quot;&gt;
          &lt;div id=&quot;car-settings&quot; class=&quot;cfct-lbl-pos-left&quot;&gt;
            &lt;div class=&quot;cfct-elm-block&quot;&gt;
              &#x27;.$this-&gt;_image_selector_size_select($size_select_args).&#x27;
            &lt;/div&gt;
            &lt;div class=&quot;cfct-elm-block has-checkbox mar-bottom-double&quot;&gt;
              &lt;input type=&quot;checkbox&quot; class=&quot;elm-checkbox&quot; id=&quot;&#x27;.$this-&gt;get_field_id(&#x27;link_images&#x27;).&#x27;&quot; name=&quot;&#x27;.$this-&gt;get_field_name(&#x27;link_images&#x27;).&#x27;&quot; value=&quot;1&quot; &#x27;.checked(&#x27;1&#x27;, isset($data[$this-&gt;get_field_name(&#x27;link_images&#x27;)]) ? $data[$this-&gt;get_field_name(&#x27;link_images&#x27;)] : &#x27;&#x27;, false).&#x27; /&gt;
              &lt;label for=&quot;&#x27;.$this-&gt;get_field_id(&#x27;link_images&#x27;).&#x27;&quot; class=&quot;lbl-checkbox&quot;&gt;&#x27;.__(&#x27;Link images&#x27;, &#x27;carrington-buld&#x27;).&#x27;&lt;/label&gt;
            &lt;/div&gt;
            &lt;div class=&quot;cfct-elm-block elm-width-100&quot;&gt;
              &lt;label for=&quot;&#x27;.$this-&gt;get_field_id(&#x27;height&#x27;).&#x27;&quot; class=&quot;lbl-text&quot;&gt;&#x27;.__(&#x27;Carousel Height&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/label&gt;
              &lt;input type=&quot;text&quot; name=&quot;&#x27;.$this-&gt;get_field_name(&#x27;height&#x27;).&#x27;&quot; id=&quot;&#x27;.$this-&gt;get_field_id(&#x27;height&#x27;).&#x27;&quot; value=&quot;&#x27;.$carousel_height.&#x27;&quot; class=&quot;elm-text&quot;/&gt;
              &lt;span class=&quot;elm-help&quot;&gt;pixels &lt;em&gt;(leave blank to set height based on tallest image)&lt;/em&gt;&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class=&quot;cfct-elm-block mar-bottom-double&quot;&gt;
              &lt;label class=&quot;lbl-select&quot; for=&quot;&#x27;.$this-&gt;get_field_id(&#x27;nav_pos&#x27;).&#x27;&quot;&gt;&#x27;.__(&#x27;Navigation position&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/label&gt;
              &lt;select id=&quot;&#x27;.$this-&gt;get_field_id(&#x27;nav_pos&#x27;).&#x27;&quot; name=&quot;&#x27;.$this-&gt;get_field_name(&#x27;nav_pos&#x27;).&#x27;&quot; class=&quot;elm-select&quot;&gt;&#x27;;
      foreach ($this-&gt;nav_positions as $nav_pos_name =&gt; $nav_pos_title) {
        $html .= &#x27;
                &lt;option value=&quot;&#x27;.$nav_pos_name.&#x27;&quot;&#x27;.selected($nav_pos_name, $nav_pos, false).&#x27;&gt;&#x27;.$nav_pos_title.&#x27;&lt;/option&gt;&#x27;;
      }    
      $html .= &#x27;
              &lt;/select&gt;
            &lt;/div&gt;
            &lt;div class=&quot;cfct-elm-block&quot;&gt;
              &lt;label  class=&quot;lbl-select&quot; for=&quot;&#x27;.$this-&gt;get_field_id(&#x27;transition&#x27;).&#x27;&quot;&gt;&#x27;.__(&#x27;Transition&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/label&gt;
              &lt;select id=&quot;&#x27;.$this-&gt;get_field_id(&#x27;transition&#x27;).&#x27;&quot; name=&quot;&#x27;.$this-&gt;get_field_name(&#x27;transition&#x27;).&#x27;&quot; class=&quot;elm-select&quot;&gt;&#x27;;
      foreach ($this-&gt;transitions as $transition_name =&gt; $transition_title) {
        $html .= &#x27;
                &lt;option value=&quot;&#x27;.$transition_name.&#x27;&quot;&#x27;.selected($transition_name, isset($data[$this-&gt;get_field_name(&#x27;transition&#x27;)]) ? $data[$this-&gt;get_field_name(&#x27;transition&#x27;)] : &#x27;&#x27;, false).&#x27;&gt;&#x27;.$transition_title.&#x27;&lt;/option&gt;&#x27;;
      }

      $html .= &#x27;
              &lt;/select&gt;
            &lt;/div&gt;
            &lt;div class=&quot;cfct-elm-block elm-width-100&quot;&gt;
              &lt;label class=&quot;lbl-text&quot; for=&quot;&#x27;.$this-&gt;get_field_name(&#x27;transition_duration&#x27;).&#x27;&quot;&gt;&#x27;.__(&#x27;Transition duration&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/label&gt;
              &lt;input type=&quot;text&quot; name=&quot;&#x27;.$this-&gt;get_field_name(&#x27;transition_duration&#x27;).&#x27;&quot; id=&quot;&#x27;.$this-&gt;get_field_id(&#x27;transition_duration&#x27;).&#x27;&quot; value=&quot;&#x27;.intval($transition_duration).&#x27;&quot; class=&quot;elm-text&quot; /&gt; 
              &lt;span class=&quot;elm-help&quot;&gt;&#x27;.__(&#x27;milliseconds&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class=&quot;cfct-elm-block elm-width-100&quot;&gt;
              &lt;label class=&quot;lbl-text&quot; for=&quot;&#x27;.$this-&gt;get_field_name(&#x27;auto_scroll&#x27;).&#x27;&quot;&gt;&#x27;.__(&#x27;Auto-scroll every&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/label&gt;
              &lt;input type=&quot;text&quot; name=&quot;&#x27;.$this-&gt;get_field_name(&#x27;auto_scroll&#x27;).&#x27;&quot; id=&quot;&#x27;.$this-&gt;get_field_id(&#x27;auto_scroll&#x27;).&#x27;&quot; value=&quot;&#x27;.intval($auto_scroll).&#x27;&quot; class=&quot;elm-text&quot; /&gt; 
              &lt;span class=&quot;elm-help&quot;&gt;&#x27;.__(&#x27;milliseconds &lt;i&gt;(set to 0 to turn off auto-scroll)&lt;/i&gt;&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/span&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          
          &lt;div id=&quot;car-items&quot; class=&quot;active&quot;&gt;
            &lt;div id=&quot;car-item-search&quot; class=&quot;car-item-search-container&quot;&gt;
              &lt;label for=&quot;car-search-term&quot;&gt;&#x27;.__(&#x27;Search to add item:&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/label&gt;
              &lt;input type=&quot;text&quot; name=&quot;car-search-term&quot; id=&quot;car-search-term&quot; value=&quot;&quot; /&gt;
              &lt;span class=&quot;elm-help elm-align-bottom&quot;&gt;&#x27;.__(&#x27;Only items with a featured image are available.&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class=&quot;car-items-wrapper&quot;&gt;
              &lt;ol class=&quot;carousel-list&quot;&gt;&#x27;;
        if (isset($data[$this-&gt;get_field_name(&#x27;posts&#x27;)]) &amp;&amp; count($data[$this-&gt;get_field_name(&#x27;posts&#x27;)])) {
          foreach ($data[$this-&gt;get_field_name(&#x27;posts&#x27;)] as $item) {
            $html .= $this-&gt;get_carousel_admin_item($item);
          }
        }
        else {
          $html .= &#x27;
                &lt;li class=&quot;no-items&quot;&gt;&#x27;.__(&#x27;No items in carousel&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;/li&gt;&#x27;;
        }
        $html .= &#x27;
              &lt;/ol&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;&#x27;;
      return $html;
    }
    
    public function update($new, $old) {
      return $new;
    }
    
    public function css() {
      return preg_replace(&#x27;/^(\t){4}/m&#x27;, &#x27;&#x27;, &#x27;
        .&#x27;.$this-&gt;id_base.&#x27; {
          border: 1px solid #ccc;
          margin: 1em 0;
          padding: 1em;
        }
        .&#x27;.$this-&gt;id_base.&#x27; div.car-content ul,
        .&#x27;.$this-&gt;id_base.&#x27; div.car-content ul li {
          margin: 0;
          padding: 0;
        }
        .&#x27;.$this-&gt;id_base.&#x27; .car-header,
        .&#x27;.$this-&gt;id_base.&#x27; .car-description,
        .&#x27;.$this-&gt;id_base.&#x27; .car-cta,
        .&#x27;.$this-&gt;id_base.&#x27; .car-pagination {
          margin: 12px 0;
        }
        .&#x27;.$this-&gt;id_base.&#x27; .car-header h2.car-title {
          margin: 0;
        }
        .&#x27;.$this-&gt;id_base.&#x27; div.car-pagination ol {
          width: 100%;
          margin: 0;
          padding: 0;
          text-align: center;
        }
        .&#x27;.$this-&gt;id_base.&#x27; .car-pagination ol li {
          display: inline;
          margin: 0 5px;
          padding: 0;
        }
        .&#x27;.$this-&gt;id_base.&#x27; .car-pagination ol li.active a {
          color: #000;
          font-weight: bold;
        }
      &#x27;);
    }
    
    public function admin_css() {
      return preg_replace(&#x27;/^(\t){4}/m&#x27;, &#x27;&#x27;, &#x27;
        .carousel-sortable-placeholder {
          height: 18px;
          background-color: gray;
          border: 1px solid white;
          border-width: 1px 0
        }
        
        /* Carousel List */
        .carousel-list {
          background-color: #eee;
          border: 1px solid #aaa;
          -moz-border-radius: 5px; /* FF1+ */
          -webkit-border-radius: 5px; /* Saf3+, Chrome */
          border-radius: 5px; /* Standard. IE9 */
          padding: 0;
          margin: 0;
        }
        .carousel-list li {
          border-bottom: 1px solid #aaa;
          list-style-type: none;
          margin: 0;
          min-height: 45px;
          padding: 5px;
        }
        .carousel-list li:hover {
          background: #fff url(&#x27;.$this-&gt;get_url().&#x27;img/carousel-drag.gif) 100% 50% no-repeat;
          cursor: move;
        }
        .carousel-list li.carousel-item-edit:hover {
          background: none;
        }
        .carousel-list li:first-child {
          -moz-border-radius-topleft: 4px; /* FF1+ */
          -webkit-border-top-left-radius: 4px; /* Saf3+, Chrome */
          border-top-left-radius: 4px; /* Standard. IE9 */
          -moz-border-radius-topright: 4px; /* FF1+ */
          -webkit-border-top-right-radius: 4px; /* Saf3+, Chrome */
          border-top-right-radius: 4px; /* Standard. IE9 */
        }
        .carousel-list li:last-child {
          border-bottom: 0;
          -moz-border-radius-bottomleft: 4px; /* FF1+ */
          -webkit-border-bottom-left-radius: 4px; /* Saf3+, Chrome */
          border-bottom-left-radius: 4px; /* Standard. IE9 */
          -moz-border-radius-bottomright: 4px; /* FF1+ */
          -webkit-border-bottom-right-radius: 4px; /* Saf3+, Chrome */
          border-bottom-right-radius: 4px; /* Standard. IE9 */
        }
        .carousel-list li.no-items {
          line-height: 45px;
        }
        
        /* clearfix */
        .carousel-list li:after { content: &quot;.&quot;; display: block; height: 0; clear: both; visibility: hidden; }

        /* Floating */
        .carousel-item-img,
        .carousel-item-title,
        .carousel-edit-form {
          float: left;
        }

        /* Setting heights */
        .carousel-item-img,
        .carousel-item-title {
          height: 45px;
        }
        .carousel-item-img {
          background: #D2CFCF url(&#x27;.$this-&gt;get_url().&#x27;img/carousel-none-icon.png) center center no-repeat;
          display: inline-block;
          margin-right: 10px;
          width: 150px;
        }
        .carousel-item-title {
          font-size: 15px;
          line-height: 42px;
        }

        /* Show/hide elements for editing */
        .carousel-item-edit .carousel-item-title {
          display: none;
        }
        .carousel-item-edit .carousel-item-img {
          height: 150px;
          background-position: 0px 0px !important;
        }
        .carousel-edit-form {
          display: none;
        }
        .carousel-item-edit .carousel-edit-form {
          display: block;
        }

        /* Edit mode */
        .carousel-edit-form {
          padding: 5px 0;
          width: 475px;
        }
        .carousel-edit-form label {
          display: none;
        }
        .carousel-edit-form input.text,
        .carousel-edit-form textarea {
          width: 90%;  
        }
        .carousel-edit-form input.text {
          font-size: 13px;
          margin-bottom: 8px;
        }
        .carousel-edit-form textarea {
          font-size: 11px;
          height: 80px;
        }
        .carousel-edit-done {
          margin-top: 7px;
        }
        .carousel-edit-remove {
          line-height: 1px;
          margin: 0 0 0 10px;
        }      
        
        /* Carousel Live Search */
        #car-items {
          min-height: 400px;
        }
        .cfct-popup-content #car-item-search {
          margin-bottom: 10px;
          position: relative;
        }
        .cfct-popup-content #car-item-search label {
          float: left;
          font-size: 13px;
          font-weight: bold;
          line-height: 23px;
          width: 165px;
        }
        .cfct-popup-content #car-item-search .elm-align-bottom {
          padding-left: 165px;
        }
        .cfct-module-form .cfct-popup-content #car-item-search #car-search-term {
          /**
           * @workaround absolute positioning fix
           * IE doesn\&#x27;t position absolute elements beneath inline-block els
           * instead, it overlays them on top of elements.
           * Basically, this caused the type-ahead search to sit on top
           * of the input. A simple display: block fixes it.
           * @affected ie7
           */
          display: block;
          margin: 0;
          width: 500px; 
        }
        .cfct-popup-content #car-item-search .otypeahead-target {
          background: white;
          border: 1px solid #ccc;
          -moz-border-radius-bottomleft: 5px; /* FF1+ */
          -moz-border-radius-bottomright: 5px; /* FF1+ */
          -webkit-border-bottom-left-radius: 5px; /* Saf3+, Chrome */
          -webkit-border-bottom-right-radius: 5px; /* Saf3+, Chrome */
          border-bottom-left-radius: 5px; /* Standard. IE9 */
          border-bottom-right-radius: 5px; /* Standard. IE9 */
          border-width: 0 1px 1px 1px;
          display: none;
          left: 0;
          margin-top: 0;
          margin-left: 165px;
          padding: 0;
          position: absolute;
          width: 498px;
          z-index: 99;
        }
        .cfct-popup-content #car-item-search .otypeahead-target ul,
        .cfct-popup-content #car-item-search .otypeahead-target li,
        .cfct-popup-content #car-item-search .otypeahead-target li a {
          margin: 0;
          padding: 0;
        }
        .cfct-popup-content #car-item-search .otypeahead-target li a {
          color: #454545;
          text-decoration: none;
          display: block;
          /*width: 738px;*/
          padding: 5px;
        }
        .cfct-popup-content #car-item-search .otypeahead-target li a:hover,
        .cfct-popup-content #car-item-search .otypeahead-target li.otypeahead-current a {
          color: #333;
          background-color: #eee;
        }
        .cfct-popup-content #car-item-search .otypeahead-target li .carousel-item-title,
        .cfct-popup-content #car-item-search .otypeahead-target li.no-items-found {
          float: none;
          font-size: 12px;
          height: 15px;
          line-height: 15px;
        }
        .cfct-popup-content #car-item-search .otypeahead-target li:last-child a {
          -moz-border-radius-bottomleft: 5px; /* FF1+ */
          -moz-border-radius-bottomright: 5px; /* FF1+ */
          -webkit-border-bottom-left-radius: 5px; /* Saf3+, Chrome */
          -webkit-border-bottom-right-radius: 5px; /* Saf3+, Chrome */
          border-bottom-left-radius: 5px; /* Standard. IE9 */
          border-bottom-right-radius: 5px; /* Standard. IE9 */
        }
        .cfct-popup-content #car-item-search .otypeahead-target li.no-items-found,
        .cfct-popup-content #car-item-search .otypeahead-target li .otypeahead-loading {
          padding: 5px;
        }
        .cfct-popup-content #car-item-search .otypeahead-target .cfct-module-carousel-loading {
          padding: 5px;
          font-size: .9em;
          color: gray;
          -moz-border-radius-bottomleft: 5px; /* FF1+ */
          -moz-border-radius-bottomright: 5px; /* FF1+ */
          -webkit-border-bottom-left-radius: 5px; /* Saf3+, Chrome */
          -webkit-border-bottom-right-radius: 5px; /* Saf3+, Chrome */
          border-bottom-left-radius: 5px; /* Standard. IE9 */
          border-bottom-right-radius: 5px; /* Standard. IE9 */
        }
        .cfct-popup-content #car-item-search .otypeahead-target li .carousel-item-img {
          display: none;
        }
      &#x27;);
    }
    
    /**
     * Admin JS functionality for type-ahead-search
     *
     * @uses o-type-ahead.js
     * @return string
     */
    public function admin_js() {
      $js_base = str_replace(&#x27;-&#x27;, &#x27;_&#x27;, $this-&gt;id_base);
      $js = preg_replace(&#x27;/^(\t){4}/m&#x27;, &#x27;&#x27;, &#x27;
      
        cfct_builder.addModuleLoadCallback(&quot;&#x27;.$this-&gt;id_base.&#x27;&quot;, function() {
          &#x27;.$this-&gt;cfct_module_tabs_js().&#x27;
          var cfct_car_link_search_results = function(target) {
            $(target).unbind().bind(&quot;otypeahead-select&quot;, function() {
              var _insert = $(this).find(&quot;li.otypeahead-current&quot;).clone().removeClass(&quot;otypeahead-current&quot;);
              &#x27;.$js_base.&#x27;_insert_selected_item(_insert);
            }).find(&quot;.car-search-elements a&quot;).click(function() {
              var _insert = $(this).closest(&quot;li&quot;).clone();
              &#x27;.$js_base.&#x27;_insert_selected_item(_insert);
              return false;
            });
          };
          // set up search
          $(&quot;#car-item-search #car-search-term&quot;).oTypeAhead({
            searchParams: {
              action: &quot;cfct_carousel_post_search&quot;,
              carousel_action: &quot;do_search&quot;
            },
            url:cfct_builder.opts.ajax_url,
            loading: &quot;&lt;div class=\&quot;&#x27;.$this-&gt;id_base.&#x27;-loading\&quot;&gt;&#x27;.__(&#x27;Loading...&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;\/div&gt;&quot;,
            form: &quot;.car-item-search-container&quot;,
            disableForm: false,
            resultsCallback: cfct_car_link_search_results
          });
                  
          // init sortabled
          $(&quot;#car-items ol&quot;).sortable({
            items: &quot;li&quot;,
            axis: &quot;y&quot;,
            opacity: 0.6,
            containment: &quot;parent&quot;,
            placeholder: &quot;carousel-sortable-placeholder&quot;
          });
          $(&quot;.car-search-pagination a&quot;).live(&quot;click&quot;, function() {
                var page_str_idx = this.href.indexOf(&quot;car_search_page=&quot;);
                var target_page = 1;
                $(&quot;#car-item-search div.otypeahead-target&quot;).html(&quot;&lt;div class=\&quot;&#x27;.$this-&gt;id_base.&#x27;-loading\&quot;&gt;&#x27;.__(&#x27;Loading...&#x27;, &#x27;carrington-build&#x27;).&#x27;&lt;\/div&gt;&quot;).slideDown(&quot;fast&quot;);
                if (page_str_idx != -1) {
                  target_page = this.href.substr(page_str_idx + 16);
                }
                $.ajax({
                  type: &quot;POST&quot;,
                  url: cfct_builder.opts.ajax_url,
                  data: {
                    action: &quot;cfct_carousel_post_search&quot;,
                    carousel_action: &quot;do_search&quot;,
                    car_search_page: target_page,
                    &quot;car-search-term&quot;: $(&quot;#car-search-term&quot;).val()
                  },
                  success: function(data){
                    $(&quot;#car-item-search div.otypeahead-target&quot;).html(data.html).show();
                    cfct_car_link_search_results($(&quot;#car-item-search div.otypeahead-target&quot;));
                  },
                  dataType: &quot;json&quot;
                });
                return false;
              });
        });

      
        var &#x27;.$js_base.&#x27;_insert_selected_item = function(_insert) {
          $(&quot;#car-items ol&quot;).append(_insert).find(&quot;.no-items&quot;).hide().end().sortable(&quot;refresh&quot;);
          $(&quot;a.carousel-post-item-ident&quot;, _insert).trigger(&quot;click&quot;);
          $(&quot;body&quot;).trigger(&quot;click&quot;);
          $(&quot;#car-item-search #car-search-term&quot;).val(&quot;&quot;);
        };
      
        cfct_builder.addModuleSaveCallback(&quot;&#x27;.$this-&gt;id_base.&#x27;&quot;, function() {
          $(&quot;#car-item-search .otypeahead-target&quot;).children().remove();
        });
      
        // set up post edit
        $(&quot;#car-items li.carousel-post-item .carousel-post-item-ident, #car-items li.carousel-post-item .carousel-item-img&quot;).live(&quot;click&quot;, function() {
          $(this).closest(&quot;.carousel-post-item&quot;).addClass(&quot;carousel-item-edit&quot;);
          return false;
        });
                
        // set up post done edit
        $(&quot;#car-items li.carousel-post-item .carousel-edit-done&quot;).live(&quot;click&quot;, function() {
          $(this).closest(&quot;.carousel-post-item&quot;).removeClass(&quot;carousel-item-edit&quot;);
          return false;
        });
                
        // set up post remove
        $(&quot;#car-items li.carousel-post-item .carousel-edit-remove a&quot;).live(&quot;click&quot;, function() {
          if (confirm(&quot;Do you really want to remove this item?&quot;)) {
            $(this).closest(&quot;.carousel-post-item&quot;).remove();
            _parent = $(&quot;#car-items ol&quot;);
            if (_parent.children().length == 1) {
              $(&quot;.no-items&quot;, _parent).show();
            }
          }
          return false;
        });
        &#x27;);
      return $js;
    }
    
    public function js() {
      return &#x27;
        /**
         * Carousel Callbacks
         */
        cfctCarousel = {};
        cfctCarousel.PagerClick = function(i, el) {
          var _this = $(el);
          var _overlay = _this.parents(&quot;.carousel&quot;).find(&quot;.car-overlay&quot;);
          $(&quot;.car-header .car-title&quot;, _overlay).html($(&quot;.car-entry-title&quot;, _this).html());
          $(&quot;.car-description&quot;, _overlay).html( $(&quot;.car-entry-description&quot;, _this).html());
          $(&quot;.car-cta a&quot;, _overlay).attr(&quot;href&quot;, $(&quot;.car-entry-cta a&quot;, _this).attr(&quot;href&quot;));
        };
        cfctCarousel.PagerAnchorBuilder = function(i, el) {
          return &quot;&lt;li&gt;&lt;a href=\&quot;#\&quot;&gt;&quot; + (i+1) + &quot;&lt;/a&gt;&lt;/li&gt;&quot;;
        };
      &#x27;;
    }
    
    /**
     * Formats the data for admin editing 
     *
     * @param $postdata - pro-processed post information
     * @return string HTML
     */
    protected function get_carousel_admin_item($postdata) {
      $img = array();
      $img_id = get_post_meta($postdata[&#x27;id&#x27;], &#x27;_thumbnail_id&#x27;, true);
      if (!empty($img_id)) {
        $imgdata = wp_get_attachment_image_src($img_id, &#x27;thumbnail&#x27;, false);
        $img_style = &#x27; style=&quot;background: url(&#x27;.$imgdata[0].&#x27;) 0 -52px&quot;&#x27;;
      }
      else {
        $img_style = null;
      }
            
      $html = &#x27;
        &lt;li class=&quot;carousel-post-item&quot;&gt;
          &lt;div class=&quot;carousel-item-img&quot;&#x27;.$img_style.&#x27;&gt;&lt;/div&gt;
          &lt;a class=&quot;carousel-post-item-ident carousel-item-title&quot; href=&quot;#carousel-post-&#x27;.intval($postdata[&#x27;id&#x27;]).&#x27;&quot;&gt;&#x27;.esc_html($postdata[&#x27;title&#x27;]).&#x27;&lt;/a&gt;
          &lt;div class=&quot;carousel-edit-form&quot;&gt;
            &lt;input type=&quot;hidden&quot; name=&quot;&#x27;.$this-&gt;get_field_name(&#x27;posts&#x27;).&#x27;[&#x27;.$postdata[&#x27;id&#x27;].&#x27;][id]&quot; value=&quot;&#x27;.intval($postdata[&#x27;id&#x27;]).&#x27;&quot; /&gt;
            &lt;label&gt;Title&lt;/label&gt;
            &lt;input type=&quot;text&quot; class=&quot;text&quot; name=&quot;&#x27;.$this-&gt;get_field_name(&#x27;posts&#x27;).&#x27;[&#x27;.$postdata[&#x27;id&#x27;].&#x27;][title]&quot; value=&quot;&#x27;.esc_attr($postdata[&#x27;title&#x27;]).&#x27;&quot; /&gt;
            &lt;label&gt;Description&lt;/label&gt;
            &lt;textarea name=&quot;&#x27;.$this-&gt;get_field_name(&#x27;posts&#x27;).&#x27;[&#x27;.$postdata[&#x27;id&#x27;].&#x27;][content]&quot;&gt;&#x27;.esc_textarea($postdata[&#x27;content&#x27;]).&#x27;&lt;/textarea&gt;
            &lt;input type=&quot;button&quot; name=&quot;done&quot; class=&quot;button carousel-edit-done&quot; value=&quot;Done&quot; /&gt;
            &lt;span class=&quot;carousel-edit-remove trash&quot;&gt;&lt;a href=&quot;#remove&quot; class=&quot;lnk-remove&quot;&gt;remove&lt;/a&gt;&lt;/span&gt;
          &lt;/div&gt;
        &lt;/li&gt;
        &#x27;;      
      return $html;
    }
    
// Search Request
    
    public function _handle_carousel_request() {
      if (!empty($_POST[&#x27;carousel_action&#x27;])) {
        switch($_POST[&#x27;carousel_action&#x27;]) {
          case &#x27;do_search&#x27;:
            $this-&gt;_carousel_do_search();
            break;
        }
        exit;
      }
    }
    
    protected function _carousel_do_search() {
      $posts_per_page = 8;
      $page = isset($_POST[&#x27;car_search_page&#x27;]) ? absint($_POST[&#x27;car_search_page&#x27;]) : 1;
      
      // ONLY PULLS POSTS THAT HAVE A FEATURED IMAGE
      $s = new WP_Query(array(
        &#x27;s&#x27; =&gt; $_POST[&#x27;car-search-term&#x27;],
        &#x27;post_type&#x27; =&gt; apply_filters(&#x27;cfct-carousel-search-in&#x27;, array_filter(get_post_types(array(&#x27;public&#x27; =&gt; 1)), array($this, &#x27;filter_post_types&#x27;))),
        &#x27;posts_per_page&#x27; =&gt; $posts_per_page,
        &#x27;paged&#x27; =&gt; $page,
        &#x27;meta_key&#x27; =&gt; &#x27;_thumbnail_id&#x27;
      ));
      
      $ids = array();
      $ret = array(
        &#x27;html&#x27; =&gt; &#x27;&#x27;,
        &#x27;key&#x27; =&gt; isset($_POST[&#x27;key&#x27;]) ? $_POST[&#x27;key&#x27;] : &#x27;&#x27;
      );
      
      
      $html = &#x27;&#x27;;
      if ($s-&gt;have_posts()) {
        $html = &#x27;&lt;ul class=&quot;car-search-elements&quot;&gt;&#x27;;
        while ($s-&gt;have_posts()) {
          $s-&gt;the_post();
          $post_id = get_the_id();
          if (in_array($post_id, $ids)) {
            continue;
          }
          $ids[] = $post_id;
          remove_filter(&#x27;the_content&#x27;, &#x27;wptexturize&#x27;);
          $postdata = array(
            &#x27;id&#x27; =&gt; get_the_id(),
            &#x27;title&#x27; =&gt; get_the_title(),
            &#x27;link&#x27; =&gt; get_permalink(),
            &#x27;content&#x27; =&gt; get_the_excerpt()
          );
          add_filter(&#x27;the_content&#x27;, &#x27;wptexturize&#x27;);
          $html .= $this-&gt;get_carousel_admin_item($postdata);
        }
        $html .= &#x27;&lt;/ul&gt;&#x27;;
        if ($s-&gt;found_posts &gt; $posts_per_page) {
          $paginate_args = array(
            &#x27;base&#x27; =&gt; &#x27;#%_%&#x27;,
            &#x27;format&#x27; =&gt; &#x27;?car_search_page=%#%&#x27;,
            &#x27;total&#x27; =&gt; $s-&gt;max_num_pages,
            &#x27;current&#x27; =&gt; $page,
            );
          $paginate_html = paginate_links($paginate_args);
          $html .= &#x27;&lt;span class=&quot;car-search-pagination&quot;&gt;&#x27;.$paginate_html.&#x27;&lt;/span&gt;&#x27;;
        }
      }
      $ret[&#x27;html&#x27;] .= $html;

      if (empty($ret[&#x27;html&#x27;])) {
        $ret[&#x27;html&#x27;] = &#x27;&lt;ul&gt;&lt;li class=&quot;no-items-found&quot;&gt;No items found for search: &quot;&#x27;.esc_html($_POST[&#x27;car-search-term&#x27;]).&#x27;&quot;&lt;/li&gt;&lt;/ul&gt;&#x27;;
      }
            
      header(&#x27;content-type: application/javascript&#x27;);
      echo json_encode($ret);
      exit;
    }
    
    protected function filter_post_types($var) {
      return !in_array($var, array(&#x27;attachment&#x27;, &#x27;revision&#x27;, &#x27;nav_menu_item&#x27;));
    }
    
// Content Move Helpers
    
    public function get_referenced_ids($data) {
      $references = array();      
      if (!empty($data[$this-&gt;gfn(&#x27;posts&#x27;)])) {
        $references[&#x27;posts&#x27;] = array();
        foreach ($data[$this-&gt;gfn(&#x27;posts&#x27;)] as $post_id =&gt; $post_info) {
          $post = get_post($post_id);
          $references[&#x27;posts&#x27;][$post_id] = array(
            &#x27;type&#x27; =&gt; &#x27;post_type&#x27;,
            &#x27;type_name&#x27; =&gt; $post-&gt;post_type,
            &#x27;value&#x27; =&gt; $post_info[&#x27;id&#x27;]
          );
        }
      }

      return $references;
    }
    
    public function merge_referenced_ids($data, $reference_data) {
      if (!empty($reference_data[&#x27;posts&#x27;]) &amp;&amp; !empty($data)) {
        foreach ($reference_data[&#x27;posts&#x27;] as $key =&gt; $r_data) {
          // Data here is stored with the post_id in the data as well as being the array key,
          // so we need to nuke the old value with the old post_id key and replace it with 
          // the new post_id as the key and the updated post_info
          $_post_info = $data[$this-&gt;gfn(&#x27;posts&#x27;)][$key];
          unset($data[$this-&gt;gfn(&#x27;posts&#x27;)][$key]);
          $_post_info[&#x27;id&#x27;] = $r_data[&#x27;value&#x27;];
          $data[$this-&gt;gfn(&#x27;posts&#x27;)][$r_data[&#x27;value&#x27;]] = $_post_info;
        }
      }

      return $data;
    }
  }
  cfct_build_register_module(&#x27;cfct_module_carousel&#x27;);
}
?&gt;
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
