<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/vendor/csstidy/class.csstidy_optimise.php - Flawless</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="Flawless"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/flawless_wpp_extensions.html">flawless_wpp_extensions</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Shortcodes.html">Shortcodes</a></li>
            
                <li><a href="../classes/Template Functions.html">Template Functions</a></li>
            
                <li><a href="../classes/Theme UI.html">Theme UI</a></li>
            
                <li><a href="../classes/UD_API.html">UD_API</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Core Assets.html">Core Assets</a></li>
            
                <li><a href="../modules/Flawless.html">Flawless</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/vendor/csstidy/class.csstidy_optimise.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php
/**
 * CSSTidy - CSS Parser and Optimiser
 *
 * CSS Optimising Class
 * This class optimises CSS data generated by csstidy.
 *
 * This file is part of CSSTidy.
 *
 * CSSTidy is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * CSSTidy is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with CSSTidy; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 *
 * @license http://opensource.org/licenses/gpl-license.php GNU Public License
 * @package csstidy
 * @author Florian Schmitz (floele at gmail dot com) 2005-2006
 */

/**
 * CSS Optimising Class
 *
 * This class optimises CSS data generated by csstidy.
 *
 * @package csstidy
 * @author Florian Schmitz (floele at gmail dot com) 2005-2006
 * @version 1.0
 */

class csstidy_optimise
{
    /**
     * Constructor
     * @param array $css contains the class csstidy
     * @access private
     * @version 1.0
     */
    function csstidy_optimise(&amp;$css)
    {
        $this-&gt;parser    =&amp; $css;
        $this-&gt;css       =&amp; $css-&gt;css;
        $this-&gt;sub_value =&amp; $css-&gt;sub_value;
        $this-&gt;at        =&amp; $css-&gt;at;
        $this-&gt;selector  =&amp; $css-&gt;selector;
        $this-&gt;property  =&amp; $css-&gt;property;
        $this-&gt;value     =&amp; $css-&gt;value;
    }

    /**
     * Optimises $css after parsing
     * @access public
     * @version 1.0
     */
    function postparse()
    {
        if ($this-&gt;parser-&gt;get_cfg(&#x27;preserve_css&#x27;)) {
            return;
        }

        if ($this-&gt;parser-&gt;get_cfg(&#x27;merge_selectors&#x27;) == 2)
        {
            foreach ($this-&gt;css as $medium =&gt; $value)
            {
                $this-&gt;merge_selectors($this-&gt;css[$medium]);
            }
        }

        if ($this-&gt;parser-&gt;get_cfg(&#x27;optimise_shorthands&#x27;) &gt; 0)
        {
            foreach ($this-&gt;css as $medium =&gt; $value)
            {
                foreach ($value as $selector =&gt; $value1)
                {
                    $this-&gt;css[$medium][$selector] = csstidy_optimise::merge_4value_shorthands($this-&gt;css[$medium][$selector]);

                    if ($this-&gt;parser-&gt;get_cfg(&#x27;optimise_shorthands&#x27;) &lt; 2) {
                        continue;
                    }

                    $this-&gt;css[$medium][$selector] = csstidy_optimise::merge_bg($this-&gt;css[$medium][$selector]);
                    if (empty($this-&gt;css[$medium][$selector])) {
                        unset($this-&gt;css[$medium][$selector]);
                    }
                }
            }
        }
    }

    /**
     * Optimises values
     * @access public
     * @version 1.0
     */
    function value()
    {
        $shorthands =&amp; $GLOBALS[&#x27;csstidy&#x27;][&#x27;shorthands&#x27;];

        // optimise shorthand properties
        if(isset($shorthands[$this-&gt;property]))
        {
            $temp = csstidy_optimise::shorthand($this-&gt;value); // FIXME - move
            if($temp != $this-&gt;value)
            {
                $this-&gt;parser-&gt;log(&#x27;Optimised shorthand notation (&#x27;.$this-&gt;property.&#x27;): Changed &quot;&#x27;.$this-&gt;value.&#x27;&quot; to &quot;&#x27;.$temp.&#x27;&quot;&#x27;,&#x27;Information&#x27;);
            }
            $this-&gt;value = $temp;
        }

        // Remove whitespace at ! important
        if($this-&gt;value != $this-&gt;compress_important($this-&gt;value))
        {
            $this-&gt;parser-&gt;log(&#x27;Optimised !important&#x27;,&#x27;Information&#x27;);
        }
    }

    /**
     * Optimises shorthands
     * @access public
     * @version 1.0
     */
    function shorthands()
    {
        $shorthands =&amp; $GLOBALS[&#x27;csstidy&#x27;][&#x27;shorthands&#x27;];

        if(!$this-&gt;parser-&gt;get_cfg(&#x27;optimise_shorthands&#x27;) || $this-&gt;parser-&gt;get_cfg(&#x27;preserve_css&#x27;)) {
            return;
        }

        if($this-&gt;property == &#x27;background&#x27; &amp;&amp; $this-&gt;parser-&gt;get_cfg(&#x27;optimise_shorthands&#x27;) &gt; 1)
        {
            unset($this-&gt;css[$this-&gt;at][$this-&gt;selector][&#x27;background&#x27;]);
            $this-&gt;parser-&gt;merge_css_blocks($this-&gt;at,$this-&gt;selector,csstidy_optimise::dissolve_short_bg($this-&gt;value));
        }
        if(isset($shorthands[$this-&gt;property]))
        {
            $this-&gt;parser-&gt;merge_css_blocks($this-&gt;at,$this-&gt;selector,csstidy_optimise::dissolve_4value_shorthands($this-&gt;property,$this-&gt;value));
            if(is_array($shorthands[$this-&gt;property]))
            {
                unset($this-&gt;css[$this-&gt;at][$this-&gt;selector][$this-&gt;property]);
            }
        }
    }

    /**
     * Optimises a sub-value
     * @access public
     * @version 1.0
     */
    function subvalue()
    {
        $replace_colors =&amp; $GLOBALS[&#x27;csstidy&#x27;][&#x27;replace_colors&#x27;];

        $this-&gt;sub_value = trim($this-&gt;sub_value);
        if($this-&gt;sub_value == &#x27;&#x27;) // caution : &#x27;0&#x27;
        {
            return;
        }

        $important = &#x27;&#x27;;
        if(csstidy::is_important($this-&gt;sub_value))
        {
            $important = &#x27;!important&#x27;;
        }
        $this-&gt;sub_value = csstidy::gvw_important($this-&gt;sub_value);

        // Compress font-weight
        if($this-&gt;property == &#x27;font-weight&#x27; &amp;&amp; $this-&gt;parser-&gt;get_cfg(&#x27;compress_font-weight&#x27;))
        {
            if($this-&gt;sub_value == &#x27;bold&#x27;)
            {
                $this-&gt;sub_value = &#x27;700&#x27;;
                $this-&gt;parser-&gt;log(&#x27;Optimised font-weight: Changed &quot;bold&quot; to &quot;700&quot;&#x27;,&#x27;Information&#x27;);
            }
            else if($this-&gt;sub_value == &#x27;normal&#x27;)
            {
                $this-&gt;sub_value = &#x27;400&#x27;;
                $this-&gt;parser-&gt;log(&#x27;Optimised font-weight: Changed &quot;normal&quot; to &quot;400&quot;&#x27;,&#x27;Information&#x27;);
            }
        }

        $temp = $this-&gt;compress_numbers($this-&gt;sub_value);
        if($temp != $this-&gt;sub_value)
        {
            if(strlen($temp) &gt; strlen($this-&gt;sub_value)) {
                $this-&gt;parser-&gt;log(&#x27;Fixed invalid number: Changed &quot;&#x27;.$this-&gt;sub_value.&#x27;&quot; to &quot;&#x27;.$temp.&#x27;&quot;&#x27;,&#x27;Warning&#x27;);
            } else {
                $this-&gt;parser-&gt;log(&#x27;Optimised number: Changed &quot;&#x27;.$this-&gt;sub_value.&#x27;&quot; to &quot;&#x27;.$temp.&#x27;&quot;&#x27;,&#x27;Information&#x27;);
            }
            $this-&gt;sub_value = $temp;
        }
        if($this-&gt;parser-&gt;get_cfg(&#x27;compress_colors&#x27;))
        {
            $temp = $this-&gt;cut_color($this-&gt;sub_value);
            if($temp !== $this-&gt;sub_value)
            {
                if(isset($replace_colors[$this-&gt;sub_value])) {
                    $this-&gt;parser-&gt;log(&#x27;Fixed invalid color name: Changed &quot;&#x27;.$this-&gt;sub_value.&#x27;&quot; to &quot;&#x27;.$temp.&#x27;&quot;&#x27;,&#x27;Warning&#x27;);
                } else {
                    $this-&gt;parser-&gt;log(&#x27;Optimised color: Changed &quot;&#x27;.$this-&gt;sub_value.&#x27;&quot; to &quot;&#x27;.$temp.&#x27;&quot;&#x27;,&#x27;Information&#x27;);
                }
                $this-&gt;sub_value = $temp;
            }
        }
        $this-&gt;sub_value .= $important;
    }

    /**
     * Compresses shorthand values. Example: margin:1px 1px 1px 1px -&gt; margin:1px
     * @param string $value
     * @access public
     * @return string
     * @version 1.0
     */
    function shorthand($value)
    {
        $important = &#x27;&#x27;;
        if(csstidy::is_important($value))
        {
            $values = csstidy::gvw_important($value);
            $important = &#x27;!important&#x27;;
        }
        else $values = $value;

        $values = explode(&#x27; &#x27;,$values);
        switch(count($values))
        {
            case 4:
            if($values[0] == $values[1] &amp;&amp; $values[0] == $values[2] &amp;&amp; $values[0] == $values[3])
            {
                return $values[0].$important;
            }
            elseif($values[1] == $values[3] &amp;&amp; $values[0] == $values[2])
            {
                return $values[0].&#x27; &#x27;.$values[1].$important;
            }
            elseif($values[1] == $values[3])
            {
                return $values[0].&#x27; &#x27;.$values[1].&#x27; &#x27;.$values[2].$important;
            }
            break;

            case 3:
            if($values[0] == $values[1] &amp;&amp; $values[0] == $values[2])
            {
                return $values[0].$important;
            }
            elseif($values[0] == $values[2])
            {
                return $values[0].&#x27; &#x27;.$values[1].$important;
            }
            break;

            case 2:
            if($values[0] == $values[1])
            {
                return $values[0].$important;
            }
            break;
        }

        return $value;
    }

    /**
     * Removes unnecessary whitespace in ! important
     * @param string $string
     * @return string
     * @access public
     * @version 1.1
     */
    function compress_important(&amp;$string)
    {
        if(csstidy::is_important($string))
        {
            $string = csstidy::gvw_important($string) . &#x27;!important&#x27;;
        }
        return $string;
    }

    /**
     * Color compression function. Converts all rgb() values to #-values and uses the short-form if possible. Also replaces 4 color names by #-values.
     * @param string $color
     * @return string
     * @version 1.1
     */
    function cut_color($color)
    {
        $replace_colors =&amp; $GLOBALS[&#x27;csstidy&#x27;][&#x27;replace_colors&#x27;];

        // rgb(0,0,0) -&gt; #000000 (or #000 in this case later)
        if(strtolower(substr($color,0,4)) == &#x27;rgb(&#x27;)
        {
            $color_tmp = substr($color,4,strlen($color)-5);
            $color_tmp = explode(&#x27;,&#x27;,$color_tmp);
            for ( $i = 0; $i &lt; count($color_tmp); $i++ )
            {
                $color_tmp[$i] = trim ($color_tmp[$i]);
                if(substr($color_tmp[$i],-1) == &#x27;%&#x27;)
                {
                    $color_tmp[$i] = round((255*$color_tmp[$i])/100);
                }
                if($color_tmp[$i]&gt;255) $color_tmp[$i] = 255;
            }
            $color = &#x27;#&#x27;;
            for ($i = 0; $i &lt; 3; $i++ )
            {
                if($color_tmp[$i]&lt;16) {
                    $color .= &#x27;0&#x27; . dechex($color_tmp[$i]);
                } else {
                    $color .= dechex($color_tmp[$i]);
                }
            }
        }

        // Fix bad color names
        if(isset($replace_colors[strtolower($color)]))
        {
            $color = $replace_colors[strtolower($color)];
        }

        // #aabbcc -&gt; #abc
        if(strlen($color) == 7)
        {
            $color_temp = strtolower($color);
            if($color_temp{0} == &#x27;#&#x27; &amp;&amp; $color_temp{1} == $color_temp{2} &amp;&amp; $color_temp{3} == $color_temp{4} &amp;&amp; $color_temp{5} == $color_temp{6})
            {
                $color = &#x27;#&#x27;.$color{1}.$color{3}.$color{5};
            }
        }

        switch(strtolower($color))
        {
            /* color name -&gt; hex code */
            case &#x27;black&#x27;: return &#x27;#000&#x27;;
            case &#x27;fuchsia&#x27;: return &#x27;#F0F&#x27;;
            case &#x27;white&#x27;: return &#x27;#FFF&#x27;;
            case &#x27;yellow&#x27;: return &#x27;#FF0&#x27;;

            /* hex code -&gt; color name */
            case &#x27;#800000&#x27;: return &#x27;maroon&#x27;;
            case &#x27;#ffa500&#x27;: return &#x27;orange&#x27;;
            case &#x27;#808000&#x27;: return &#x27;olive&#x27;;
            case &#x27;#800080&#x27;: return &#x27;purple&#x27;;
            case &#x27;#008000&#x27;: return &#x27;green&#x27;;
            case &#x27;#000080&#x27;: return &#x27;navy&#x27;;
            case &#x27;#008080&#x27;: return &#x27;teal&#x27;;
            case &#x27;#c0c0c0&#x27;: return &#x27;silver&#x27;;
            case &#x27;#808080&#x27;: return &#x27;gray&#x27;;
            case &#x27;#f00&#x27;: return &#x27;red&#x27;;
        }

        return $color;
    }

    /**
     * Compresses numbers (ie. 1.0 becomes 1 or 1.100 becomes 1.1 )
     * @param string $subvalue
     * @return string
     * @version 1.2
     */
    function compress_numbers($subvalue)
    {
        $units =&amp; $GLOBALS[&#x27;csstidy&#x27;][&#x27;units&#x27;];
        $unit_values =&amp; $GLOBALS[&#x27;csstidy&#x27;][&#x27;unit_values&#x27;];
        $color_values =&amp; $GLOBALS[&#x27;csstidy&#x27;][&#x27;color_values&#x27;];

        // for font:1em/1em sans-serif...;
        if($this-&gt;property == &#x27;font&#x27;)
        {
            $temp = explode(&#x27;/&#x27;,$subvalue);
        }
        else
        {
            $temp = array($subvalue);
        }
        for ($l = 0; $l &lt; count($temp); $l++)
        {
            // continue if no numeric value
            if (!(strlen($temp[$l]) &gt; 0 &amp;&amp; ( is_numeric($temp[$l]{0}) || $temp[$l]{0} == &#x27;+&#x27; || $temp[$l]{0} == &#x27;-&#x27; ) ))
            {
                continue;
            }

            // Fix bad colors
            if (in_array($this-&gt;property, $color_values))
            {
                $temp[$l] = &#x27;#&#x27;.$temp[$l];
            }

            if (floatval($temp[$l]) == 0)
            {
                $temp[$l] = &#x27;0&#x27;;
            }
            else
            {
                $unit_found = FALSE;
                for ($m = 0, $size_4 = count($units); $m &lt; $size_4; $m++)
                {
                    if (strpos(strtolower($temp[$l]),$units[$m]) !== FALSE)
                    {
                        $temp[$l] = floatval($temp[$l]).$units[$m];
                        $unit_found = TRUE;
                        break;
                    }
                }
                if (!$unit_found &amp;&amp; in_array($this-&gt;property,$unit_values,TRUE))
                {
                    $temp[$l] = floatval($temp[$l]).&#x27;px&#x27;;
                }
                else if (!$unit_found)
                {
                    $temp[$l] = floatval($temp[$l]);
                }
                // Remove leading zero
                if (abs(floatval($temp[$l])) &lt; 1) {
                    if (floatval($temp[$l]) &lt; 0) {
                        $temp[$l] = &#x27;-&#x27; . substr($temp[$l], 2);
                    } else {
                        $temp[$l] = substr($temp[$l], 1);
                    }
                }
            }
        }

        return ((count($temp) &gt; 1) ? $temp[0].&#x27;/&#x27;.$temp[1] : $temp[0]);
    }

    /**
     * Merges selectors with same properties. Example: a{color:red} b{color:red} -&gt; a,b{color:red}
     * Very basic and has at least one bug. Hopefully there is a replacement soon.
     * @param array $array
     * @return array
     * @access public
     * @version 1.2
     */
    function merge_selectors(&amp;$array)
    {
        $css = $array;
        foreach($css as $key =&gt; $value)
        {
            if(!isset($css[$key]))
            {
                continue;
            }
            $newsel = &#x27;&#x27;;

            // Check if properties also exist in another selector
            $keys = array();
            // PHP bug (?) without $css = $array; here
            foreach($css as $selector =&gt; $vali)
            {
                if($selector == $key)
                {
                    continue;
                }

                if($css[$key] === $vali)
                {
                    $keys[] = $selector;
                }
            }

            if(!empty($keys))
            {
                $newsel = $key;
                unset($css[$key]);
                foreach($keys as $selector)
                {
                    unset($css[$selector]);
                    $newsel .= &#x27;,&#x27;.$selector;
                }
                $css[$newsel] = $value;
            }
        }
        $array = $css;
    }

    /**
     * Dissolves properties like padding:10px 10px 10px to padding-top:10px;padding-bottom:10px;...
     * @param string $property
     * @param string $value
     * @return array
     * @version 1.0
     * @see merge_4value_shorthands()
     */
    function dissolve_4value_shorthands($property,$value)
    {
        $shorthands =&amp; $GLOBALS[&#x27;csstidy&#x27;][&#x27;shorthands&#x27;];
        if(!is_array($shorthands[$property]))
        {
            $return[$property] = $value;
            return $return;
        }

        $important = &#x27;&#x27;;
        if(csstidy::is_important($value))
        {
            $value = csstidy::gvw_important($value);
            $important = &#x27;!important&#x27;;
        }
        $values = explode(&#x27; &#x27;,$value);


        $return = array();
        if(count($values) == 4)
        {
            for($i=0;$i&lt;4;$i++)
            {
                $return[$shorthands[$property][$i]] = $values[$i].$important;
            }
        }
        elseif(count($values) == 3)
        {
            $return[$shorthands[$property][0]] = $values[0].$important;
            $return[$shorthands[$property][1]] = $values[1].$important;
            $return[$shorthands[$property][3]] = $values[1].$important;
            $return[$shorthands[$property][2]] = $values[2].$important;
        }
        elseif(count($values) == 2)
        {
            for($i=0;$i&lt;4;$i++)
            {
                $return[$shorthands[$property][$i]] = (($i % 2 != 0)) ? $values[1].$important : $values[0].$important;
            }
        }
        else
        {
            for($i=0;$i&lt;4;$i++)
            {
                $return[$shorthands[$property][$i]] = $values[0].$important;
            }
        }

        return $return;
    }

    /**
     * Explodes a string as explode() does, however, not if $sep is escaped or within a string.
     * @param string $sep seperator
     * @param string $string
     * @return array
     * @version 1.0
     */
    function explode_ws($sep,$string)
    {
        $status = &#x27;st&#x27;;
        $to = &#x27;&#x27;;

        $output = array();
        $num = 0;
        for($i = 0, $len = strlen($string);$i &lt; $len; $i++)
        {
            switch($status)
            {
                case &#x27;st&#x27;:
                if($string{$i} == $sep &amp;&amp; !csstidy::escaped($string,$i))
                {
                    ++$num;
                }
                elseif($string{$i} == &#x27;&quot;&#x27; || $string{$i} == &#x27;\&#x27;&#x27; || $string{$i} == &#x27;(&#x27; &amp;&amp; !csstidy::escaped($string,$i))
                {
                    $status = &#x27;str&#x27;;
                    $to = ($string{$i} == &#x27;(&#x27;) ? &#x27;)&#x27; : $string{$i};
                    (isset($output[$num])) ? $output[$num] .= $string{$i} : $output[$num] = $string{$i};
                }
                else
                {
                    (isset($output[$num])) ? $output[$num] .= $string{$i} : $output[$num] = $string{$i};
                }
                break;

                case &#x27;str&#x27;:
                if($string{$i} == $to &amp;&amp; !csstidy::escaped($string,$i))
                {
                    $status = &#x27;st&#x27;;
                }
                (isset($output[$num])) ? $output[$num] .= $string{$i} : $output[$num] = $string{$i};
                break;
            }
        }

        if(isset($output[0]))
        {
            return $output;
        }
        else
        {
            return array($output);
        }
    }

    /**
     * Merges Shorthand properties again, the opposite of dissolve_4value_shorthands()
     * @param array $array
     * @return array
     * @version 1.2
     * @see dissolve_4value_shorthands()
     */
    function merge_4value_shorthands($array)
    {
        $return = $array;
        $shorthands =&amp; $GLOBALS[&#x27;csstidy&#x27;][&#x27;shorthands&#x27;];

        foreach($shorthands as $key =&gt; $value)
        {
            if(isset($array[$value[0]]) &amp;&amp; isset($array[$value[1]])
            &amp;&amp; isset($array[$value[2]]) &amp;&amp; isset($array[$value[3]]) &amp;&amp; $value !== 0)
            {
                $return[$key] = &#x27;&#x27;;

                $important = &#x27;&#x27;;
                for($i = 0; $i &lt; 4; $i++)
                {
                    $val = $array[$value[$i]];
                    if(csstidy::is_important($val))
                    {
                        $important = &#x27;!important&#x27;;
                        $return[$key] .= csstidy::gvw_important($val).&#x27; &#x27;;
                    }
                    else
                    {
                        $return[$key] .= $val.&#x27; &#x27;;
                    }
                    unset($return[$value[$i]]);
                }
                $return[$key] = csstidy_optimise::shorthand(trim($return[$key].$important));
            }
        }
        return $return;
    }

    /**
     * Dissolve background property
     * @param string $str_value
     * @return array
     * @version 1.0
     * @see merge_bg()
     * @todo full CSS 3 compliance
     */
    function dissolve_short_bg($str_value)
    {
        $background_prop_default =&amp; $GLOBALS[&#x27;csstidy&#x27;][&#x27;background_prop_default&#x27;];
        $repeat = array(&#x27;repeat&#x27;,&#x27;repeat-x&#x27;,&#x27;repeat-y&#x27;,&#x27;no-repeat&#x27;,&#x27;space&#x27;);
        $attachment = array(&#x27;scroll&#x27;,&#x27;fixed&#x27;,&#x27;local&#x27;);
        $clip = array(&#x27;border&#x27;,&#x27;padding&#x27;);
        $origin = array(&#x27;border&#x27;,&#x27;padding&#x27;,&#x27;content&#x27;);
        $pos = array(&#x27;top&#x27;,&#x27;center&#x27;,&#x27;bottom&#x27;,&#x27;left&#x27;,&#x27;right&#x27;);
        $important = &#x27;&#x27;;
        $return = array(&#x27;background-image&#x27; =&gt; NULL,&#x27;background-size&#x27; =&gt; NULL,&#x27;background-repeat&#x27; =&gt; NULL,&#x27;background-position&#x27; =&gt; NULL,&#x27;background-attachment&#x27;=&gt;NULL,&#x27;background-clip&#x27; =&gt; NULL,&#x27;background-origin&#x27; =&gt; NULL,&#x27;background-color&#x27; =&gt; NULL);

        if(csstidy::is_important($str_value))
        {
            $important = &#x27; !important&#x27;;
            $str_value = csstidy::gvw_important($str_value);
        }

        $str_value = csstidy_optimise::explode_ws(&#x27;,&#x27;,$str_value);
        for($i = 0; $i &lt; count($str_value); $i++)
        {
            $have[&#x27;clip&#x27;] = FALSE; $have[&#x27;pos&#x27;] = FALSE;
            $have[&#x27;color&#x27;] = FALSE; $have[&#x27;bg&#x27;] = FALSE;

            $str_value[$i] = csstidy_optimise::explode_ws(&#x27; &#x27;,trim($str_value[$i]));

            for($j = 0; $j &lt; count($str_value[$i]); $j++)
            {
                if($have[&#x27;bg&#x27;] === FALSE &amp;&amp; (substr($str_value[$i][$j],0,4) == &#x27;url(&#x27; || $str_value[$i][$j] === &#x27;none&#x27;))
                {
                    $return[&#x27;background-image&#x27;] .= $str_value[$i][$j].&#x27;,&#x27;;
                    $have[&#x27;bg&#x27;] = TRUE;
                }
                elseif(in_array($str_value[$i][$j],$repeat,TRUE))
                {
                    $return[&#x27;background-repeat&#x27;] .= $str_value[$i][$j].&#x27;,&#x27;;
                }
                elseif(in_array($str_value[$i][$j],$attachment,TRUE))
                {
                    $return[&#x27;background-attachment&#x27;] .= $str_value[$i][$j].&#x27;,&#x27;;
                }
                elseif(in_array($str_value[$i][$j],$clip,TRUE) &amp;&amp; !$have[&#x27;clip&#x27;])
                {
                    $return[&#x27;background-clip&#x27;] .= $str_value[$i][$j].&#x27;,&#x27;;
                    $have[&#x27;clip&#x27;] = TRUE;
                }
                elseif(in_array($str_value[$i][$j],$origin,TRUE))
                {
                    $return[&#x27;background-origin&#x27;] .= $str_value[$i][$j].&#x27;,&#x27;;
                }
                elseif($str_value[$i][$j]{0} == &#x27;(&#x27;)
                {
                    $return[&#x27;background-size&#x27;] .= substr($str_value[$i][$j],1,-1).&#x27;,&#x27;;
                }
                elseif(in_array($str_value[$i][$j],$pos,TRUE) || is_numeric($str_value[$i][$j]{0}) || $str_value[$i][$j]{0} === NULL)
                {
                    $return[&#x27;background-position&#x27;] .= $str_value[$i][$j];
                    if(!$have[&#x27;pos&#x27;]) $return[&#x27;background-position&#x27;] .= &#x27; &#x27;; else $return[&#x27;background-position&#x27;].= &#x27;,&#x27;;
                    $have[&#x27;pos&#x27;] = TRUE;
                }
                elseif(!$have[&#x27;color&#x27;])
                {
                    $return[&#x27;background-color&#x27;] .= $str_value[$i][$j].&#x27;,&#x27;;
                    $have[&#x27;color&#x27;] = TRUE;
                }
            }
        }

        foreach($background_prop_default as $bg_prop =&gt; $default_value)
        {
            if($return[$bg_prop] !== NULL)
            {
                $return[$bg_prop] = substr($return[$bg_prop],0,-1).$important;
            }
            else $return[$bg_prop] = $default_value.$important;
        }
        return $return;
    }

    /**
     * Merges all background properties
     * @param array $input_css
     * @return array
     * @version 1.0
     * @see dissolve_short_bg()
     * @todo full CSS 3 compliance
     */
    function merge_bg($input_css)
    {
        $background_prop_default =&amp; $GLOBALS[&#x27;csstidy&#x27;][&#x27;background_prop_default&#x27;];
        // Max number of background images. CSS3 not yet fully implemented
        $number_of_values = @max(count(csstidy_optimise::explode_ws(&#x27;,&#x27;,$input_css[&#x27;background-image&#x27;])),count(csstidy_optimise::explode_ws(&#x27;,&#x27;,$input_css[&#x27;background-color&#x27;])),1);
        // Array with background images to check if BG image exists
        $bg_img_array = @csstidy_optimise::explode_ws(&#x27;,&#x27;,csstidy::gvw_important($input_css[&#x27;background-image&#x27;]));
        $new_bg_value = &#x27;&#x27;;
        $important = &#x27;&#x27;;

        for($i = 0; $i &lt; $number_of_values; $i++)
        {
            foreach($background_prop_default as $bg_property =&gt; $default_value)
            {
                // Skip if property does not exist
                if(!isset($input_css[$bg_property]))
                {
                    continue;
                }

                $cur_value = $input_css[$bg_property];

                // Skip some properties if there is no background image
                if((!isset($bg_img_array[$i]) || $bg_img_array[$i] === &#x27;none&#x27;)
                    &amp;&amp; ($bg_property === &#x27;background-size&#x27; || $bg_property === &#x27;background-position&#x27;
                    || $bg_property === &#x27;background-attachment&#x27; || $bg_property === &#x27;background-repeat&#x27;))
                {
                    continue;
                }

                // Remove !important
                if(csstidy::is_important($cur_value))
                {
                    $important = &#x27; !important&#x27;;
                    $cur_value = csstidy::gvw_important($cur_value);
                }

                // Do not add default values
                if($cur_value === $default_value)
                {
                    continue;
                }

                $temp = csstidy_optimise::explode_ws(&#x27;,&#x27;,$cur_value);

                if(isset($temp[$i]))
                {
                    if($bg_property == &#x27;background-size&#x27;)
                    {
                        $new_bg_value .= &#x27;(&#x27;.$temp[$i].&#x27;) &#x27;;
                    }
                    else
                    {
                        $new_bg_value .= $temp[$i].&#x27; &#x27;;
                    }
                }
            }

            $new_bg_value = trim($new_bg_value);
            if($i != $number_of_values-1) $new_bg_value .= &#x27;,&#x27;;
        }

        // Delete all background-properties
        foreach($background_prop_default as $bg_property =&gt; $default_value)
        {
            unset($input_css[$bg_property]);
        }

        // Add new background property
        if($new_bg_value !== &#x27;&#x27;) $input_css[&#x27;background&#x27;] = $new_bg_value.$important;

        return $input_css;
    }
}
?&gt;
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
